<!DOCTYPE html><html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns#"><head itemscope itemtype="http://schema.org/WebSite"><!--[if IE]><![endif]--><link rel="dns-prefetch" href="//fonts.googleapis.com" /><link rel="stylesheet" href="http://www.androidhive.info/wp-content/cache/min/1/911656fa177846aec61d653c98674a7b.css" data-minify="1"/><link rel="stylesheet" href="http://www.androidhive.info/wp-content/cache/min/1/eb9f2973d1f94378cd51f247183dd68f.css" data-minify="1"/><link rel="stylesheet" href="http://www.androidhive.info/wp-content/cache/min/1/ed23373be97de98fd59b5c1ee55222f2.css" data-minify="1"/><meta charset="UTF-8"> <!--[if IE ]><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <![endif]--><link rel="profile" href="http://gmpg.org/xfn/11" /><link rel="icon" href="http://test.androidhive.info/wp-content/uploads/2016/04/favicon.png" type="image/x-icon" /><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta itemprop="name" content="androidhive" /><meta itemprop="url" content="http://www.androidhive.info" /><meta itemprop="creator accountablePerson" content=" " /><link rel="pingback" href="http://www.androidhive.info/xmlrpc.php" /><title>Android Building Realtime Chat App using GCM, PHP &amp; MySQL - Part 3</title><style type="text/css">.thrive-adminbar-icon {
				background: url('http://www.androidhive.info/wp-content/plugins/thrive-leads/tcb/editor/css/images/tcb-close-icon.png') no-repeat 0px 0px;
				padding-left: 25px !important;
				width: 20px !important;
				height: 20px !important;
			}</style> <script type="text/javascript">document.documentElement.className = document.documentElement.className.replace( /\bno-js\b/,'js' );</script> <meta name="description" content="Android tutorial about integrating Google Cloud Messaging 3.0. Explained with an example of realtime chat app using PHP &amp; MySQL including android app and an admin panel."/><meta name="robots" content="noodp"/><link rel="canonical" href="http://www.androidhive.info/2016/02/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-3/" /><meta property="og:locale" content="en_US" /><meta property="og:type" content="article" /><meta property="og:title" content="Android Building Realtime Chat App using GCM, PHP &amp; MySQL - Part 3" /><meta property="og:description" content="Android tutorial about integrating Google Cloud Messaging 3.0. Explained with an example of realtime chat app using PHP &amp; MySQL including android app and an admin panel." /><meta property="og:url" content="http://www.androidhive.info/2016/02/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-3/" /><meta property="og:site_name" content="androidhive" /><meta property="article:section" content="GCM" /><meta property="article:published_time" content="2016-02-09T07:45:04+00:00" /><meta property="article:modified_time" content="2016-02-18T04:16:40+00:00" /><meta property="og:updated_time" content="2016-02-18T04:16:40+00:00" /><meta property="og:image" content="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-using-gcm-php-mysql-part-3.png" /><meta property="og:image:width" content="720" /><meta property="og:image:height" content="316" /><meta name="twitter:card" content="summary" /><meta name="twitter:description" content="Android tutorial about integrating Google Cloud Messaging 3.0. Explained with an example of realtime chat app using PHP &amp; MySQL including android app and an admin panel." /><meta name="twitter:title" content="Android Building Realtime Chat App using GCM, PHP &amp; MySQL - Part 3" /><meta name="twitter:image" content="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-using-gcm-php-mysql-part-3.png" /><link rel="alternate" type="application/rss+xml" title="androidhive &raquo; Feed" href="http://www.androidhive.info/feed/" /><link rel="alternate" type="application/rss+xml" title="androidhive &raquo; Comments Feed" href="http://www.androidhive.info/comments/feed/" /> <script type="text/javascript">window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.androidhive.info\/wp-includes\/js\/wp-emoji-release.min.js"}};
			!function(a,b,c){function d(a){var c,d=b.createElement("canvas"),e=d.getContext&&d.getContext("2d");return e&&e.fillText?(e.textBaseline="top",e.font="600 32px Arial","flag"===a?(e.fillText(String.fromCharCode(55356,56806,55356,56826),0,0),d.toDataURL().length>3e3):"diversity"===a?(e.fillText(String.fromCharCode(55356,57221),0,0),c=e.getImageData(16,16,1,1).data.toString(),e.fillText(String.fromCharCode(55356,57221,55356,57343),0,0),c!==e.getImageData(16,16,1,1).data.toString()):("simple"===a?e.fillText(String.fromCharCode(55357,56835),0,0):e.fillText(String.fromCharCode(55356,57135),0,0),0!==e.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);</script> <style type="text/css">img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}</style><style id='stylesheet-inline-css' type='text/css'>body {background-color:#ffffff; }
		body {background-image: url( http://www.androidhive.info/wp-content/themes/androidhive-theme/images/nobg.png );}

        .header-social a:hover, header .breadcrumb > div i:hover, header .breadcrumb > div a:hover, .breadcrumb > div a:hover, .post-info a, .latestPost .title a:hover, #site-footer .toggle-menu .toggle-caret .fa:hover, #primary-navigation .sub-menu a:hover, .latestPost .title a:hover, ul.ajax-search-results li a:hover, .sidebar .ajax-search-meta a, .breadcrumb > div i, .single .tags a, .postauthor h5 a:hover, .sidebar a, .comment-meta a, .trending-stories .latestPost .title:hover, .postauthor h5, .copyrights a, .single_post a, .textwidget a, .pnavigation2 a, #sidebar a:hover, .copyrights a:hover, #site-footer .widget li a:hover, .related-posts a:hover, .reply a, .title a:hover, .post-info a:hover, .comm, #tabber .inside li a:hover, .readMore a:hover, .fn a, a, a:hover { color: #000000; }

        .latestPost-categories ul li:hover a, .footer-widgets h3, .reply a:hover, #primary-navigation .sub-menu a:hover, #primary-navigation .sub-menu li.current-menu-item a { color: #000000 !important; }

        .latestPost-news .latestPost { border-top: 2px solid #000000; }

        
        .navigation.mobile-menu-wrapper { background: #000000 !important; }

        #header, .pace .pace-progress, #mobile-menu-wrapper ul li a:hover, .widget h3:before, .featured-category-title:before, .widget .wpt_widget_content .tab_title.selected a, #move-to-top, #load-posts, .featured-videos h4:after, .related-posts h4:after, .postauthor h4:after, #comments h4:after, #commentsAdd h4:after, .contact-form input[type='submit'], #commentform input#submit:hover, .contact-form input[type='submit']:hover, #primary-navigation li a:hover, .pagination a:hover, .pagination ul, .latestPost-review-wrapper, a#pull, #commentform input#submit, .contactform #submit, #move-to-top:hover, .navigation ul .current-menu-item > a, .navigation ul li:hover, .pagination a, #tabber ul.tabs li a.selected, .tagcloud a:hover, .latestPost .review-type-circle.review-total-only, .latestPost .review-type-circle.wp-review-show-total, .single .pagination > .current, .bypostauthor .comment-author .fn:after { background-color:#000000; color: #fff!important; }

		.owl-prev, .owl-next { background-color:#000000!important; }

        #site-footer { background: #EAEAEA; }
		
		.shareit { top: 282px; left: 0; margin: 0; width: 90px; position: fixed; padding: 5px; border:none; border-right: 0;}
		.share-item {margin: 2px;}
		
		.bypostauthor { background: none; }
        .bypostauthor > div .comment-author .fn:after { content: "Author"; position: relative; padding: 2px 10px; margin: 0 10px; color: #FFF; font-size: 13px; line-height: 1; font-weight: normal; border-radius: 3px; }</style> <script type='text/javascript' src='http://www.androidhive.info/wp-includes/js/jquery/jquery.js?ver=1.11.3'></script> <script type='text/javascript' src='http://www.androidhive.info/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/plugins/thrive-leads/tcb/editor/js/compat.min.js?ver=1.200.5'></script> <script type='text/javascript'>/*  */
var mts_customscript = {"responsive":"1","nav_menu":"primary"};
/*  */</script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/themes/androidhive-theme/js/customscript.js'></script> <script type='text/javascript'>/*  */
var tickeropts = {"rtl_support":"0"};
/*  */</script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/themes/androidhive-theme/js/jquery.webticker.js'></script> <link rel='https://api.w.org/' href='http://www.androidhive.info/wp-json/' /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.androidhive.info/xmlrpc.php?rsd" /><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.androidhive.info/wp-includes/wlwmanifest.xml" /><link rel='shortlink' href='http://www.androidhive.info/?p=39056' /><link rel="alternate" type="application/json+oembed" href="http://www.androidhive.info/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.androidhive.info%2F2016%2F02%2Fandroid-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-3%2F" /><link rel="alternate" type="text/xml+oembed" href="http://www.androidhive.info/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.androidhive.info%2F2016%2F02%2Fandroid-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-3%2F&#038;format=xml" /> <script type="text/javascript">window._wp_rp_static_base_url = 'https://wprp.zemanta.com/static/';
	window._wp_rp_wp_ajax_url = "http://www.androidhive.info/wp-admin/admin-ajax.php";
	window._wp_rp_plugin_version = '3.6';
	window._wp_rp_post_id = '39056';
	window._wp_rp_num_rel_posts = '4';
	window._wp_rp_thumbnails = true;
	window._wp_rp_post_title = 'Android+Building+Realtime+Chat+App+using+GCM%2C+PHP+%26+MySQL+-+Part+3';
	window._wp_rp_post_tags = ['php', 'push+notifications', 'recyclerview', 'gcm', 'rest', 'google', 'slim', 'json', 'volley', 'mysql', 'chat', 'php', 'room', 'server', 'app', 'screen', 'mysql', 'librari', 'height', 'api', 'counter', 'thread', 'panel', 'android', 'cover'];
	window._wp_rp_promoted_content = true;</script> <script type="text/javascript" src="https://wprp.zemanta.com/static/js/loader.js?version=3.6" async></script> <style type="text/css">.related_post_title {
}
ul.related_post {
}
ul.related_post li {
}
ul.related_post li a {
}
ul.related_post li img {
}</style><link href="//fonts.googleapis.com/css?family=Open+Sans|Merriweather&amp;subset=latin" rel="stylesheet" type="text/css"><style type="text/css">#header h1, #header h2 { font-family: 'Open Sans'; font-weight: ; font-size: 25px; color: #ffffff; }
.menu li, .menu li a { font-family: 'Open Sans'; font-weight: ; font-size: 15px; color: #ffffff; }
.latestPost .title a, .latestPost-news .title, .latestPost .title { font-family: 'Merriweather'; font-weight: ; font-size: 23px; color: #252525; }
.single-title { font-family: 'Merriweather'; font-weight: ; font-size: 35px; color: #252525; }
body { font-family: 'Open Sans'; font-weight: ; font-size: 15px; color: #252525; }
.widget h3, .featured-category-title { font-family: 'Open Sans'; font-weight: ; font-size: 15px; color: #252525; }
#sidebar .widget { font-family: 'Open Sans'; font-weight: ; font-size: 14px; color: #252525; }
.footer-widgets, footer .widget li a { font-family: 'Open Sans'; font-weight: ; font-size: 13px; color: #252525; }
h1 { font-family: 'Merriweather'; font-weight: ; font-size: 35px; color: #252525; }
h2 { font-family: 'Merriweather'; font-weight: ; font-size: 24px; color: #252525; }
h3 { font-family: 'Merriweather'; font-weight: ; font-size: 25px; color: #252525; }
h4 { font-family: 'Merriweather'; font-weight: ; font-size: 20px; color: #252525; }
h5 { font-family: 'Merriweather'; font-weight: ; font-size: 18px; color: #252525; }
h6 { font-family: 'Merriweather'; font-weight: ; font-size: 16px; color: #252525; }</style><style type="text/css" id="syntaxhighlighteranchor"></style> <script data-no-minify="1" data-cfasync="false">(function(w,d){function a(){var b=d.createElement("script");b.async=!0;b.src="http://www.androidhive.info/wp-content/plugins/wp-rocket/inc/front/js/lazyload.1.0.2.min.js";var a=d.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)}w.attachEvent?w.attachEvent("onload",a):w.addEventListener("load",a,!1)})(window,document);</script> <style type="text/css">#nik{opacity:.0002;height:auto;width:auto;position:absolute;top:50px;left:50px;border-bottom:1px #76e042 solid;border-bottom:0 blue solid;color:#fff;padding:0;z-index:1001;font-size:13px;background:red}</style><div id="nik"> <a href="#" onclick="getValue()"> </a> <script type="text/javascript">(function () {
                                var hidden = "hidden";

                    // Standards:
                    if (hidden in document)
                                document.addEventListener("visibilitychange", onchange);
                                else if ((hidden = "mozHidden") in document)
                                document.addEventListener("mozvisibilitychange", onchange);                 else if ((hidden = "webkitHidden") in document)
                                document.addEventListener("webkitvisibilitychange", onchange);
                                else if ((hidden = "msHidden") in document)
                                document.addEventListener("msvisibilitychange", onchange);                 // IE 9 and lower:
                                else if ("onfocusin" in document)
                                document.onfocusin = document.onfocusout = onchange;
                    // All others:
                    else
                                window.onpageshow = window.onpagehide
                                        = window.onfocus = window.onblur = onchange;

                    function onchange(evt) {
                        var v = "visible", h = "hidden",
                                        evtMap = {focus: v, focusin: v, pageshow: v, blur: h, focusout: h, pagehide: h};
                                        evt = evt || window.event;
                        if (evt.type in evtMap) {
                                chkvis(evtMap[evt.type]);
                                }
                        else {
                                var visible = this[hidden] ? "hidden" : "visible";
                                        chkvis(visible);
                                }
                    }

                        // set the initial state (but only if browser supports the Page Visibility API)
                        if (document[hidden] !== undefined)
                        onchange({type: document[hidden] ? "blur" : "focus"});
                })();
                        function chkvis(status) {
                            if (status == 'hidden') {
                                createCookie('k', 'p');
                                document.getElementById('nik').style.display = 'none';
                            }
                        }

                var t = 3, ts = 45, te = 55;
                var r = Math.floor(Math.random() * (t)) + 1;
                var d = new Date();
                var n = d.getMinutes();

                var p1 = '<script async src="\/\/pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><\/script> <!-- Article --> <ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9207768510467156" data-ad-slot="1410361821"><\/ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); <\/script>';
                var p2 = '<script async src="\/\/pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><\/script> <!-- End --> <ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9207768510467156" data-ad-slot="4363828227"><\/ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); <\/script>';
                var p3 = '<script async src="\/\/pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><\/script> <!-- Middle Content --> <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-9207768510467156" data-ad-slot="2887095024"><\/ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); <\/script>';


               
                
                    if (getCookie("k") !== "p") {

                        switch (r) {
                            case 1:
                                document.write(p1);
                                break;
                            case 2:
                                document.write(p2);
                                break;
                            default:
                                document.write(p3);
                        }
                    }
                
               

                function createCookie(name, value) {
                    var date = new Date();
                    date.setTime(date.getTime() + (86400));
                    var expires = "; expires=" + date.toGMTString();

                    document.cookie = name + "=" + value + expires + "; path=/";
                }

                function getCookie(cname) {
                    var name = cname + "=";
                    var ca = document.cookie.split(';');
                    for (var i = 0; i < ca.length; i++) {
                        var c = ca[i];
                        while (c.charAt(0) == ' ')
                            c = c.substring(1);
                        if (c.indexOf(name) == 0)
                            return c.substring(name.length, c.length);
                    }
                    return "";
                }

                function isInArray(array, search)
                {
                    return array.indexOf(search) >= 0;
                }</script> </div> <script type="text/javascript">var div = document.getElementById('nik');
                                                document.addEventListener('mousemove', function (e) {
                                                div.style.left = e.pageX - 160 + "px";
                                                        div.style.top = e.pageY - 60 + "px";
                                                });</script> <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24602371-1', 'auto');
  ga('send', 'pageview');</script> </head><body id="blog" class="single single-post postid-39056 single-format-standard main" itemscope itemtype="http://schema.org/WebPage"><div class="main-container"> <header id="site-header" role="banner" itemscope itemtype="http://schema.org/WPHeader"><div class="upper-navigation"><div class="container clearfix"><div class="breadcrumb"><div class="root"><a href="http://www.androidhive.info/"><i class="fa fa-home"></i></a></div><div class="breaking"><ul class="trending-slider"><li><a href="http://www.androidhive.info/2016/05/android-working-with-card-view-and-recycler-view/" title="Android working with Card View and Recycler View">Android working with Card View and Recycler View</a></li><li><a href="http://www.androidhive.info/2016/02/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-3/" title="Android Building Realtime Chat App using GCM, PHP &#038; MySQL &#8211; Part 3">Android Building Realtime Chat App using GCM, PHP &#038; MySQL &#8211; Part 3</a></li><li><a href="http://www.androidhive.info/2016/02/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-2/" title="Android Building Realtime Chat App using GCM, PHP &#038; MySQL &#8211; Part 2">Android Building Realtime Chat App using GCM, PHP &#038; MySQL &#8211; Part 2</a></li><li><a href="http://www.androidhive.info/2016/02/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-1/" title="Android Building Realtime Chat App using GCM, PHP &#038; MySQL &#8211; Part 1">Android Building Realtime Chat App using GCM, PHP &#038; MySQL &#8211; Part 1</a></li><li><a href="http://www.androidhive.info/2015/12/android-material-design-floating-action-button/" title="Android Material Design Floating Action Button">Android Material Design Floating Action Button</a></li><li><a href="http://www.androidhive.info/2015/09/android-material-design-snackbar-example/" title="Android Material Design Snackbar Example">Android Material Design Snackbar Example</a></li><li><a href="http://www.androidhive.info/2015/09/android-material-design-floating-labels-for-edittext/" title="Android Material Design Floating Labels for EditText">Android Material Design Floating Labels for EditText</a></li><li><a href="http://www.androidhive.info/2015/09/android-material-design-working-with-tabs/" title="Android Material Design working with Tabs">Android Material Design working with Tabs</a></li><li><a href="http://www.androidhive.info/2015/06/android-push-notifications-using-parse-com/" title="Android Push Notifications using Parse.com">Android Push Notifications using Parse.com</a></li><li><a href="http://www.androidhive.info/2015/04/android-getting-started-with-material-design/" title="Android Getting Started with Material Design">Android Getting Started with Material Design</a></li></ul></div></div><div class="header-social"> <a rel="nofollow" href="http://www.facebook.com/ravi8x" class="header-facebook"><span class="fa fa-facebook"></span></a> <a rel="nofollow" href="http://www.twitter.com/ravitamada" class="header-twitter"><span class="fa fa-twitter"></span></a> <a rel="nofollow" href="https://plus.google.com/u/0/108738908574182577919/posts" class="header-google-plus"><span class="fa fa-google-plus"></span></a> <a rel="nofollow" href="http://instagram.com/ravitamada" class="header-instagram"><span class="fa fa-instagram"></span></a></div></div></div><div id="header"><div class="container"><div class="logo-wrap"><h1 id="logo" class="image-logo" itemprop="headline"> <a href="http://www.androidhive.info"><img src="http://www.androidhive.info/wp-content/uploads/2016/04/logo-3.png" alt="androidhive"></a></h1></div><div id="primary-navigation" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement"> <a href="#" id="pull" class="toggle-mobile-menu">Menu</a> <nav class="navigation clearfix mobile-menu-wrapper"><ul id="menu-menu-1" class="menu clearfix"><li id="menu-item-39241" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-39241"><a href="http://download.androidhive.info">Downloads</a></li><li id="menu-item-39242" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-39242"><a href="http://tips.androidhive.info">Tips</a></li><li id="menu-item-39327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39327"><a href="http://www.androidhive.info/write-for-us/">Write for Us</a></li></ul> </nav></div></div></div> </header><div id="page" class="single"> <article class="article" itemscope itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-using-gcm-php-mysql-part-3.png" /><div id="content_box" ><div id="post-39056" class="g post post-39056 type-post status-publish format-standard has-post-thumbnail hentry category-gcm category-google category-json category-mysql category-php category-push-notifications category-recyclerview category-rest category-slim category-volley has_thumb"><div class="breadcrumb" xmlns:v="http://rdf.data-vocabulary.org/#"><div typeof="v:Breadcrumb" class="root"><a rel="v:url" property="v:title" href="http://www.androidhive.info" rel="nofollow">Home</a></div><div><i class="fa fa-angle-right"></i></div><div typeof="v:Breadcrumb"><a href="http://www.androidhive.info/category/gcm/" rel="v:url" property="v:title">GCM</a></div><div><i class="fa fa-angle-right"></i></div><div><span>Android Building Realtime Chat App using GCM, PHP &#038; MySQL &#8211; Part 3</span></div></div><div class="single_post"> <header><h1 class="title single-title entry-title" itemprop="headline">Android Building Realtime Chat App using GCM, PHP &#038; MySQL &#8211; Part 3</h1><div class="post-info"> <span class="theauthor">by <span itemprop="author"><a rel="nofollow" href="http://www.androidhive.info/author/admin/" title="Posts by Ravi Tamada" rel="author">Ravi Tamada</a><span class="divider1">/</span></span></span> <span class="thetime updated"><span itemprop="datePublished">February 9, 2016<span class="divider1">/</span></span></span> <span class="thecomment"><i class="fa fa-comments"></i> <a href="http://www.androidhive.info/2016/02/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-3/#disqus_thread">Comments</a></span></div> </header><div class="post-single-content box mark-links entry-content"><div class="thecontent" itemprop="articleBody"><div style="float:left;margin:10px 10px 10px 0;"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>  <ins class="adsbygoogle"
style="display:inline-block;width:336px;height:280px"
data-ad-client="ca-pub-9207768510467156"
data-ad-slot="1410361821"></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div><p>In the <a href="http://www.androidhive.info/2016/02/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-1" target="_blank">1st</a> &#038; <a href="http://www.androidhive.info/2016/02/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-2" target="_blank">2nd</a> parts of this article, we have built the server app including the REST API and admin panel. We also covered the initializing a project with gcm integrated with few primary tests.</p><p>This part covers a realtime scenario of GCM usage by providing a crucial information like performing dynamic actions like updating UI depending on type of the notification. The actions like incrementing the message counter in the list, automatically appearing the messages in chat thread is explained.</p><div style="display:none"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://www.androidhive.info/wp-content/uploads/2016/02/android-google-cloud-messaging-realtime-chat-app.png" alt="android realtime chat app using gcm php mysql" width="720" height="541" class="alignnone size-full wp-image-39105" srcset="http://www.androidhive.info/wp-content/uploads/2016/02/android-google-cloud-messaging-realtime-chat-app-300x225.png 300w, http://www.androidhive.info/wp-content/uploads/2016/02/android-google-cloud-messaging-realtime-chat-app.png 720w" sizes="(max-width: 720px) 100vw, 720px" /><noscript><img src="http://www.androidhive.info/wp-content/uploads/2016/02/android-google-cloud-messaging-realtime-chat-app.png" alt="android realtime chat app using gcm php mysql" width="720" height="541" class="alignnone size-full wp-image-39105" srcset="http://www.androidhive.info/wp-content/uploads/2016/02/android-google-cloud-messaging-realtime-chat-app-300x225.png 300w, http://www.androidhive.info/wp-content/uploads/2016/02/android-google-cloud-messaging-realtime-chat-app.png 720w" sizes="(max-width: 720px) 100vw, 720px" /></noscript></div><div class="clear"></div><div class="download_code"><a href="http://download.androidhive.info/download?code=ezIaenBbBvpi9mHPgfJORAf29XiwLMoBYda5USk3IGtj6%2Faczubg6fCH0vmiw9zHaMdsR5SffC%2Fre3SW9U7yMBKw6UcfzOxvM9abmgXdKVv1IqCCx0krVRKXw%3D%3DV49ttmJZCuX14D55E1n1NQdeFCYyRRMEhlJ" target="_blank">DOWNLOAD CODE</a></div><div class="download_code"><a href="http://demo.androidhive.info/gcm_chat/" target="_blank">LIVE DEMO</a></div><div class="yt_video"> <label>VIDEO DEMO</label><br /> <iframe src="http://www.youtube.com/embed/jGuv7QOwYSQ" frameborder="0" allowfullscreen="" style="width: 719px; height: 444.7265625px;"></iframe></div><h2>Building Realtime Chat App</h2><p>The chat app mainly contains three screens. First is Login Screen where the user will be prompted to enter name and email. Second screen is Chat Rooms list screen where list of chat rooms. The third screen displays the discussion of a single chat room where the discussion messages will be aligned left and right.</p><h3>Adding Volley Support</h3><p>We use android <a href="http://www.androidhive.info/2014/05/android-working-with-volley-library-1/" target="_blank">volley</a> library to make all the http requests to rest api endpoints. Volley provides an easy way to handle the http requests and responses.</p><p><strong>1</strong>. Open <strong>build.gradle</strong> located under <strong>app</strong> directory and add <strong>volley</strong> dependency and rebuild the project.</p><pre class="brush: php; title: build.gradle; notranslate" title="build.gradle">
dependencies {
    ...
    compile 'com.mcxiaoke.volley:library-aar:1.0.0'
}
</pre><p><strong>2</strong>. Open <strong>MyApplication.java</strong> located under <strong>app</strong> package and modify the code as below. Here I am creating singleton instance of volley <strong>RequestQueue</strong>.</p><pre class="brush: java; title: MyApplication.java; notranslate" title="MyApplication.java">
package info.androidhive.gcm.app;

/**
 * Created by Lincoln on 14/10/15.
 */

import android.app.Application;
import android.content.Intent;
import android.text.TextUtils;

import com.android.volley.Request;
import com.android.volley.RequestQueue;
import com.android.volley.toolbox.Volley;

import info.androidhive.gcm.activity.LoginActivity;
import info.androidhive.gcm.helper.MyPreferenceManager;

/**
 * Created by Ravi on 13/05/15.
 */

public class MyApplication extends Application {

    public static final String TAG = MyApplication.class
            .getSimpleName();

    private RequestQueue mRequestQueue;

    private static MyApplication mInstance;

    private MyPreferenceManager pref;

    @Override
    public void onCreate() {
        super.onCreate();
        mInstance = this;
    }

    public static synchronized MyApplication getInstance() {
        return mInstance;
    }

    public RequestQueue getRequestQueue() {
        if (mRequestQueue == null) {
            mRequestQueue = Volley.newRequestQueue(getApplicationContext());
        }

        return mRequestQueue;
    }

    public MyPreferenceManager getPrefManager() {
        if (pref == null) {
            pref = new MyPreferenceManager(this);
        }

        return pref;
    }

    public &lt;T&gt; void addToRequestQueue(Request&lt;T&gt; req, String tag) {
        req.setTag(TextUtils.isEmpty(tag) ? TAG : tag);
        getRequestQueue().add(req);
    }

    public &lt;T&gt; void addToRequestQueue(Request&lt;T&gt; req) {
        req.setTag(TAG);
        getRequestQueue().add(req);
    }

    public void cancelPendingRequests(Object tag) {
        if (mRequestQueue != null) {
            mRequestQueue.cancelAll(tag);
        }
    }

    public void logout() {
        pref.clear();
        Intent intent = new Intent(this, LoginActivity.class);
        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
        startActivity(intent);
    }
}
</pre><p><strong>3</strong>. Create a package named <strong>model</strong>. Inside <strong>model</strong> package, create three classes named <strong>User.java</strong>, <strong>Message.java</strong> and <strong>ChatRoom.java</strong>. Theses classes will be used to create objects while parsing the json responses. You can also notice that, these classes implements <strong>Serializable</strong> which allows us to pass objects to an activity using intents.</p><pre class="brush: java; title: User.java; notranslate" title="User.java">
package info.androidhive.gcm.model;

import java.io.Serializable;

public class User implements Serializable {
    String id, name, email;

    public User() {
    }

    public User(String id, String name, String email) {
        this.id = id;
        this.name = name;
        this.email = email;
    }

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }
}

</pre><pre class="brush: java; title: Message.java; notranslate" title="Message.java">
package info.androidhive.gcm.model;

import java.io.Serializable;

public class Message implements Serializable {
    String id, message, createdAt;
    User user;

    public Message() {
    }

    public Message(String id, String message, String createdAt, User user) {
        this.id = id;
        this.message = message;
        this.createdAt = createdAt;
        this.user = user;
    }

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public String getCreatedAt() {
        return createdAt;
    }

    public void setCreatedAt(String createdAt) {
        this.createdAt = createdAt;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }
}
</pre><pre class="brush: java; title: ChatRoom.java; notranslate" title="ChatRoom.java">
package info.androidhive.gcm.model;

import java.io.Serializable;

public class ChatRoom implements Serializable {
    String id, name, lastMessage, timestamp;
    int unreadCount;

    public ChatRoom() {
    }

    public ChatRoom(String id, String name, String lastMessage, String timestamp, int unreadCount) {
        this.id = id;
        this.name = name;
        this.lastMessage = lastMessage;
        this.timestamp = timestamp;
        this.unreadCount = unreadCount;
    }

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getLastMessage() {
        return lastMessage;
    }

    public void setLastMessage(String lastMessage) {
        this.lastMessage = lastMessage;
    }

    public int getUnreadCount() {
        return unreadCount;
    }

    public void setUnreadCount(int unreadCount) {
        this.unreadCount = unreadCount;
    }

    public String getTimestamp() {
        return timestamp;
    }

    public void setTimestamp(String timestamp) {
        this.timestamp = timestamp;
    }
}

</pre><p><strong>4</strong>. Open <strong>MyPreferenceManager.java</strong> and add <strong>storeUser()</strong> and <strong>getUser()</strong> methods which stores the user information in shared preferences. These methods will be called once the user successfully logged in.</p><pre class="brush: java; title: MyPreferenceManager.java; notranslate" title="MyPreferenceManager.java">
package info.androidhive.gcm.helper;

import android.content.Context;
import android.content.SharedPreferences;
import android.util.Log;

import info.androidhive.gcm.model.User;

/**
 * Created by Lincoln on 07/01/16.
 */
public class MyPreferenceManager {

    private String TAG = MyPreferenceManager.class.getSimpleName();

    // Shared Preferences
    SharedPreferences pref;

    // Editor for Shared preferences
    SharedPreferences.Editor editor;

    // Context
    Context _context;

    // Shared pref mode
    int PRIVATE_MODE = 0;

    // Sharedpref file name
    private static final String PREF_NAME = &quot;androidhive_gcm&quot;;

    // All Shared Preferences Keys
    private static final String KEY_USER_ID = &quot;user_id&quot;;
    private static final String KEY_USER_NAME = &quot;user_name&quot;;
    private static final String KEY_USER_EMAIL = &quot;user_email&quot;;
    private static final String KEY_NOTIFICATIONS = &quot;notifications&quot;;

    // Constructor
    public MyPreferenceManager(Context context) {
        this._context = context;
        pref = _context.getSharedPreferences(PREF_NAME, PRIVATE_MODE);
        editor = pref.edit();
    }


    public void storeUser(User user) {
        editor.putString(KEY_USER_ID, user.getId());
        editor.putString(KEY_USER_NAME, user.getName());
        editor.putString(KEY_USER_EMAIL, user.getEmail());
        editor.commit();

        Log.e(TAG, &quot;User is stored in shared preferences. &quot; + user.getName() + &quot;, &quot; + user.getEmail());
    }

    public User getUser() {
        if (pref.getString(KEY_USER_ID, null) != null) {
            String id, name, email;
            id = pref.getString(KEY_USER_ID, null);
            name = pref.getString(KEY_USER_NAME, null);
            email = pref.getString(KEY_USER_EMAIL, null);

            User user = new User(id, name, email);
            return user;
        }
        return null;
    }

    public void addNotification(String notification) {

        // get old notifications
        String oldNotifications = getNotifications();

        if (oldNotifications != null) {
            oldNotifications += &quot;|&quot; + notification;
        } else {
            oldNotifications = notification;
        }

        editor.putString(KEY_NOTIFICATIONS, oldNotifications);
        editor.commit();
    }

    public String getNotifications() {
        return pref.getString(KEY_NOTIFICATIONS, null);
    }

    public void clear() {
        editor.clear();
        editor.commit();
    }
}
</pre><p><strong>5</strong>. Create <strong>EndPoints.java</strong> in <strong>app</strong> package. Here we declare the REST API endpoint urls. If you are testing the app on localhost, use the correct <strong>Ip address</strong> of the computer on which php services are running.</p><pre class="brush: java; title: EndPoints.java; notranslate" title="EndPoints.java">
package info.androidhive.gcm.app;

public class EndPoints {

    // localhost url - 
    public static final String BASE_URL = &quot;http://192.168.0.101/gcm_chat/v1&quot;;
    public static final String LOGIN = BASE_URL + &quot;/user/login&quot;;
    public static final String USER = BASE_URL + &quot;/user/_ID_&quot;;
    public static final String CHAT_ROOMS = BASE_URL + &quot;/chat_rooms&quot;;
    public static final String CHAT_THREAD = BASE_URL + &quot;/chat_rooms/_ID_&quot;;
    public static final String CHAT_ROOM_MESSAGE = BASE_URL + &quot;/chat_rooms/_ID_/message&quot;;
}
</pre><p><strong>6</strong>. Open <strong>GcmIntentService.java</strong> located under <strong>gcm</strong> package and modify the code as below. Here I have modified the code <strong>sendRegistrationToServer()</strong> method to send the gcm registration token to our server to update it in <strong>MySQL</strong> database.</p><pre class="brush: java; title: ; notranslate" title="">
package info.androidhive.gcm.gcm;

import android.app.IntentService;
import android.content.Intent;
import android.content.SharedPreferences;
import android.preference.PreferenceManager;
import android.support.v4.content.LocalBroadcastManager;
import android.util.Log;
import android.widget.Toast;

import com.android.volley.NetworkResponse;
import com.android.volley.Request;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;
import com.google.android.gms.gcm.GcmPubSub;
import com.google.android.gms.gcm.GoogleCloudMessaging;
import com.google.android.gms.iid.InstanceID;

import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import info.androidhive.gcm.R;
import info.androidhive.gcm.app.Config;
import info.androidhive.gcm.app.EndPoints;
import info.androidhive.gcm.app.MyApplication;
import info.androidhive.gcm.model.User;

public class GcmIntentService extends IntentService {

    private static final String TAG = GcmIntentService.class.getSimpleName();

    public GcmIntentService() {
        super(TAG);
    }

    public static final String KEY = &quot;key&quot;;
    public static final String TOPIC = &quot;topic&quot;;
    public static final String SUBSCRIBE = &quot;subscribe&quot;;
    public static final String UNSUBSCRIBE = &quot;unsubscribe&quot;;


    @Override
    protected void onHandleIntent(Intent intent) {
        String key = intent.getStringExtra(KEY);
        switch (key) {
            case SUBSCRIBE:
                // subscribe to a topic
                String topic = intent.getStringExtra(TOPIC);
                subscribeToTopic(topic);
                break;
            case UNSUBSCRIBE:
                break;
            default:
                // if key is specified, register with GCM
                registerGCM();
        }

    }

    /**
     * Registering with GCM and obtaining the gcm registration id
     */
    private void registerGCM() {
        SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(this);

        try {
            InstanceID instanceID = InstanceID.getInstance(this);
            String token = instanceID.getToken(getString(R.string.gcm_defaultSenderId),
                    GoogleCloudMessaging.INSTANCE_ID_SCOPE, null);

            Log.e(TAG, &quot;GCM Registration Token: &quot; + token);

            // sending the registration id to our server
            sendRegistrationToServer(token);

            sharedPreferences.edit().putBoolean(Config.SENT_TOKEN_TO_SERVER, true).apply();
        } catch (Exception e) {
            Log.e(TAG, &quot;Failed to complete token refresh&quot;, e);

            sharedPreferences.edit().putBoolean(Config.SENT_TOKEN_TO_SERVER, false).apply();
        }
        // Notify UI that registration has completed, so the progress indicator can be hidden.
        Intent registrationComplete = new Intent(Config.REGISTRATION_COMPLETE);
        LocalBroadcastManager.getInstance(this).sendBroadcast(registrationComplete);
    }

    private void sendRegistrationToServer(final String token) {

        // checking for valid login session
        User user = MyApplication.getInstance().getPrefManager().getUser();
        if (user == null) {
            // TODO
            // user not found, redirecting him to login screen
            return;
        }

        String endPoint = EndPoints.USER.replace(&quot;_ID_&quot;, user.getId());

        Log.e(TAG, &quot;endpoint: &quot; + endPoint);

        StringRequest strReq = new StringRequest(Request.Method.PUT,
                endPoint, new Response.Listener&lt;String&gt;() {

            @Override
            public void onResponse(String response) {
                Log.e(TAG, &quot;response: &quot; + response);

                try {
                    JSONObject obj = new JSONObject(response);

                    // check for error
                    if (obj.getBoolean(&quot;error&quot;) == false) {
                        // broadcasting token sent to server
                        Intent registrationComplete = new Intent(Config.SENT_TOKEN_TO_SERVER);
                        LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(registrationComplete);
                    } else {
                        Toast.makeText(getApplicationContext(), &quot;Unable to send gcm registration id to our sever. &quot; + obj.getJSONObject(&quot;error&quot;).getString(&quot;message&quot;), Toast.LENGTH_LONG).show();
                    }

                } catch (JSONException e) {
                    Log.e(TAG, &quot;json parsing error: &quot; + e.getMessage());
                    Toast.makeText(getApplicationContext(), &quot;Json parse error: &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();
                }
            }
        }, new Response.ErrorListener() {

            @Override
            public void onErrorResponse(VolleyError error) {
                NetworkResponse networkResponse = error.networkResponse;
                Log.e(TAG, &quot;Volley error: &quot; + error.getMessage() + &quot;, code: &quot; + networkResponse);
                Toast.makeText(getApplicationContext(), &quot;Volley error: &quot; + error.getMessage(), Toast.LENGTH_SHORT).show();
            }
        }) {

            @Override
            protected Map&lt;String, String&gt; getParams() {
                Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();
                params.put(&quot;gcm_registration_id&quot;, token);

                Log.e(TAG, &quot;params: &quot; + params.toString());
                return params;
            }
        };

        //Adding request to request queue
        MyApplication.getInstance().addToRequestQueue(strReq);
    }

    /**
     * Subscribe to a topic
     */
    public static void subscribeToTopic(String topic) {
        GcmPubSub pubSub = GcmPubSub.getInstance(MyApplication.getInstance().getApplicationContext());
        InstanceID instanceID = InstanceID.getInstance(MyApplication.getInstance().getApplicationContext());
        String token = null;
        try {
            token = instanceID.getToken(MyApplication.getInstance().getApplicationContext().getString(R.string.gcm_defaultSenderId),
                    GoogleCloudMessaging.INSTANCE_ID_SCOPE, null);
            if (token != null) {
                pubSub.subscribe(token, &quot;/topics/&quot; + topic, null);
                Log.e(TAG, &quot;Subscribed to topic: &quot; + topic);
            } else {
                Log.e(TAG, &quot;error: gcm registration id is null&quot;);
            }
        } catch (IOException e) {
            Log.e(TAG, &quot;Topic subscribe error. Topic: &quot; + topic + &quot;, error: &quot; + e.getMessage());
            Toast.makeText(MyApplication.getInstance().getApplicationContext(), &quot;Topic subscribe error. Topic: &quot; + topic + &quot;, error: &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();
        }
    }

    public void unsubscribeFromTopic(String topic) {
        GcmPubSub pubSub = GcmPubSub.getInstance(getApplicationContext());
        InstanceID instanceID = InstanceID.getInstance(getApplicationContext());
        String token = null;
        try {
            token = instanceID.getToken(getString(R.string.gcm_defaultSenderId),
                    GoogleCloudMessaging.INSTANCE_ID_SCOPE, null);
            if (token != null) {
                pubSub.unsubscribe(token, &quot;&quot;);
                Log.e(TAG, &quot;Unsubscribed from topic: &quot; + topic);
            } else {
                Log.e(TAG, &quot;error: gcm registration id is null&quot;);
            }
        } catch (IOException e) {
            Log.e(TAG, &quot;Topic unsubscribe error. Topic: &quot; + topic + &quot;, error: &quot; + e.getMessage());
            Toast.makeText(getApplicationContext(), &quot;Topic subscribe error. Topic: &quot; + topic + &quot;, error: &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();
        }
    }
}

</pre><h2>Adding Login Screen</h2><p>With all the required files in place, we&#8217;ll add the first app screen i.e login screen. Login screen is added for the purpose of collecting user&#8217;s name and email. Note that this is not a proper authentication method as it won&#8217;t requires the password to be entered. Any user can login into our app by entering any random name and email.</p><p><strong>7</strong>. Open <strong>strings.xml</strong> located under <strong>values</strong> and add the below string values.</p><pre class="brush: xml; title: strings.xml; notranslate" title="strings.xml">
&lt;resources&gt;
    &lt;string name=&quot;app_name&quot;&gt;Google Cloud Messaging&lt;/string&gt;
    &lt;string name=&quot;action_settings&quot;&gt;Settings&lt;/string&gt;
    &lt;string name=&quot;title_activity_login&quot;&gt;LoginActivity&lt;/string&gt;
    &lt;string name=&quot;hint_name&quot;&gt;Full Name&lt;/string&gt;
    &lt;string name=&quot;hint_email&quot;&gt;Email&lt;/string&gt;
    &lt;string name=&quot;err_msg_name&quot;&gt;Enter full name&lt;/string&gt;
    &lt;string name=&quot;err_msg_email&quot;&gt;Enter valid email address&lt;/string&gt;
    &lt;string name=&quot;title_activity_chat_room_discussion&quot;&gt;ChatRoomDiscussionActivity&lt;/string&gt;
    &lt;string name=&quot;action_logout&quot;&gt;Logout&lt;/string&gt;
&lt;/resources&gt;
</pre><p><strong>8</strong>. Open <strong>colors.xml</strong> and add below color values.</p><pre class="brush: xml; title: colors.xml; notranslate" title="colors.xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;
    &lt;color name=&quot;colorPrimary&quot;&gt;#7B1FA2&lt;/color&gt;
    &lt;color name=&quot;colorPrimaryDark&quot;&gt;#6A1B9A&lt;/color&gt;
    &lt;color name=&quot;colorAccent&quot;&gt;#EA80FC&lt;/color&gt;
    &lt;color name=&quot;list_divider&quot;&gt;#dedede&lt;/color&gt;
    &lt;color name=&quot;bg_bubble_self&quot;&gt;#E1E1E1&lt;/color&gt;
&lt;/resources&gt;
</pre><p><strong>9</strong>. Create an activity named <strong>LoginActivity.java</strong> by right clicking on <strong>activity  New  Activity  Blank Activity</strong>. This also creates <strong>activity_login.xml</strong> and <strong>content_login.xml</strong> layout files for login activity.</p><p><strong>10</strong>. Open <strong>activity_login.xml</strong> and modify the layout as below. Here I have added the appbar and a toolbar.</p><pre class="brush: xml; title: activity_login.xml; notranslate" title="activity_login.xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;android.support.design.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:fitsSystemWindows=&quot;true&quot;
    tools:context=&quot;info.androidhive.gcm.activity.LoginActivity&quot;&gt;

    &lt;android.support.design.widget.AppBarLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:theme=&quot;@style/AppTheme.AppBarOverlay&quot;&gt;

        &lt;android.support.v7.widget.Toolbar
            android:id=&quot;@+id/toolbar&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;?attr/actionBarSize&quot;
            android:background=&quot;?attr/colorPrimary&quot;
            app:popupTheme=&quot;@style/AppTheme.PopupOverlay&quot; /&gt;

    &lt;/android.support.design.widget.AppBarLayout&gt;

    &lt;include layout=&quot;@layout/content_login&quot; /&gt;

&lt;/android.support.design.widget.CoordinatorLayout&gt;
</pre><p><strong>11</strong>. Open <strong>activity_login.xml</strong> and create a simple <a href="http://www.androidhive.info/2015/09/android-material-design-floating-labels-for-edittext/" target="_blank">login form</a> with name and email input fields.</p><pre class="brush: xml; title: activity_login.xml; notranslate" title="activity_login.xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;
    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;
    app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;
    tools:context=&quot;info.androidhive.gcm.activity.LoginActivity&quot;
    tools:showIn=&quot;@layout/activity_login&quot;&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:orientation=&quot;vertical&quot;&gt;

        &lt;android.support.design.widget.TextInputLayout
            android:id=&quot;@+id/input_layout_name&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;&gt;

            &lt;EditText
                android:id=&quot;@+id/input_name&quot;
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:hint=&quot;@string/hint_name&quot; /&gt;

        &lt;/android.support.design.widget.TextInputLayout&gt;

        &lt;android.support.design.widget.TextInputLayout
            android:id=&quot;@+id/input_layout_email&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;&gt;

            &lt;EditText
                android:id=&quot;@+id/input_email&quot;
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:hint=&quot;@string/hint_email&quot; /&gt;

        &lt;/android.support.design.widget.TextInputLayout&gt;

        &lt;Button android:id=&quot;@+id/btn_enter&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;Enter&quot; /&gt;

    &lt;/LinearLayout&gt;

    &lt;ProgressBar
        android:id=&quot;@+id/progressBar&quot;
        android:layout_width=&quot;30dp&quot;
        android:layout_height=&quot;30dp&quot;
        android:layout_alignParentBottom=&quot;true&quot;
        android:layout_centerHorizontal=&quot;true&quot;
        android:layout_gravity=&quot;center&quot;
        android:layout_marginBottom=&quot;10dp&quot;
        android:indeterminateTint=&quot;@color/colorAccent&quot;
        android:visibility=&quot;gone&quot;
        android:indeterminateTintMode=&quot;src_atop&quot; /&gt;

&lt;/RelativeLayout&gt;
</pre><p><strong>12</strong>. Open <strong>LoginActivity.java</strong> and paste the below code. Here</p><p><strong>></strong> Before setting the contentView, we&#8217;ll check for user session in shared preferences. If the user is already logged in, the MainActivity will be launched.</p><p><strong>></strong> <strong>login()</strong> method makes an http request to login endpoint by passing <strong>name</strong> and <strong>email</strong> as post parameters. On the server a new user will be created and the json response will be served.</p><p><strong>></strong> After parsing the json, user session will be created by storing the user object in shared preferences and <strong>MainActivity</strong> will be launched.</p><pre class="brush: java; title: LoginActivity.java; notranslate" title="LoginActivity.java">
package info.androidhive.gcm.activity;

import android.content.Intent;
import android.os.Bundle;
import android.support.design.widget.TextInputLayout;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.Toolbar;
import android.text.Editable;
import android.text.TextUtils;
import android.text.TextWatcher;
import android.util.Log;
import android.view.View;
import android.view.WindowManager;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.android.volley.NetworkResponse;
import com.android.volley.Request;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;

import org.json.JSONException;
import org.json.JSONObject;

import java.util.HashMap;
import java.util.Map;

import info.androidhive.gcm.R;
import info.androidhive.gcm.app.EndPoints;
import info.androidhive.gcm.app.MyApplication;
import info.androidhive.gcm.model.User;

public class LoginActivity extends AppCompatActivity {

    private String TAG = LoginActivity.class.getSimpleName();
    private EditText inputName, inputEmail;
    private TextInputLayout inputLayoutName, inputLayoutEmail;
    private Button btnEnter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        /**
         * Check for login session. It user is already logged in
         * redirect him to main activity
         * */
        if (MyApplication.getInstance().getPrefManager().getUser() != null) {
            startActivity(new Intent(this, MainActivity.class));
            finish();
        }

        setContentView(R.layout.activity_login);

        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        setSupportActionBar(toolbar);
        inputLayoutName = (TextInputLayout) findViewById(R.id.input_layout_name);
        inputLayoutEmail = (TextInputLayout) findViewById(R.id.input_layout_email);
        inputName = (EditText) findViewById(R.id.input_name);
        inputEmail = (EditText) findViewById(R.id.input_email);
        btnEnter = (Button) findViewById(R.id.btn_enter);

        inputName.addTextChangedListener(new MyTextWatcher(inputName));
        inputEmail.addTextChangedListener(new MyTextWatcher(inputEmail));

        btnEnter.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                login();
            }
        });
    }

    /**
     * logging in user. Will make http post request with name, email
     * as parameters
     */
    private void login() {
        if (!validateName()) {
            return;
        }

        if (!validateEmail()) {
            return;
        }

        final String name = inputName.getText().toString();
        final String email = inputEmail.getText().toString();

        StringRequest strReq = new StringRequest(Request.Method.POST,
                EndPoints.LOGIN, new Response.Listener&lt;String&gt;() {

            @Override
            public void onResponse(String response) {
                Log.e(TAG, &quot;response: &quot; + response);

                try {
                    JSONObject obj = new JSONObject(response);

                    // check for error flag
                    if (obj.getBoolean(&quot;error&quot;) == false) {
                        // user successfully logged in

                        JSONObject userObj = obj.getJSONObject(&quot;user&quot;);
                        User user = new User(userObj.getString(&quot;user_id&quot;),
                                userObj.getString(&quot;name&quot;),
                                userObj.getString(&quot;email&quot;));

                        // storing user in shared preferences
                        MyApplication.getInstance().getPrefManager().storeUser(user);

                        // start main activity
                        startActivity(new Intent(getApplicationContext(), MainActivity.class));
                        finish();

                    } else {
                        // login error - simply toast the message
                        Toast.makeText(getApplicationContext(), &quot;&quot; + obj.getJSONObject(&quot;error&quot;).getString(&quot;message&quot;), Toast.LENGTH_LONG).show();
                    }

                } catch (JSONException e) {
                    Log.e(TAG, &quot;json parsing error: &quot; + e.getMessage());
                    Toast.makeText(getApplicationContext(), &quot;Json parse error: &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();
                }
            }
        }, new Response.ErrorListener() {

            @Override
            public void onErrorResponse(VolleyError error) {
                NetworkResponse networkResponse = error.networkResponse;
                Log.e(TAG, &quot;Volley error: &quot; + error.getMessage() + &quot;, code: &quot; + networkResponse);
                Toast.makeText(getApplicationContext(), &quot;Volley error: &quot; + error.getMessage(), Toast.LENGTH_SHORT).show();
            }
        }) {

            @Override
            protected Map&lt;String, String&gt; getParams() {
                Map&lt;String, String&gt; params = new HashMap&lt;&gt;();
                params.put(&quot;name&quot;, name);
                params.put(&quot;email&quot;, email);

                Log.e(TAG, &quot;params: &quot; + params.toString());
                return params;
            }
        };

        //Adding request to request queue
        MyApplication.getInstance().addToRequestQueue(strReq);
    }

    private void requestFocus(View view) {
        if (view.requestFocus()) {
            getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_STATE_ALWAYS_VISIBLE);
        }
    }

    // Validating name
    private boolean validateName() {
        if (inputName.getText().toString().trim().isEmpty()) {
            inputLayoutName.setError(getString(R.string.err_msg_name));
            requestFocus(inputName);
            return false;
        } else {
            inputLayoutName.setErrorEnabled(false);
        }

        return true;
    }

    // Validating email
    private boolean validateEmail() {
        String email = inputEmail.getText().toString().trim();

        if (email.isEmpty() || !isValidEmail(email)) {
            inputLayoutEmail.setError(getString(R.string.err_msg_email));
            requestFocus(inputEmail);
            return false;
        } else {
            inputLayoutEmail.setErrorEnabled(false);
        }

        return true;
    }

    private static boolean isValidEmail(String email) {
        return !TextUtils.isEmpty(email) &amp;&amp; android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches();
    }

    private class MyTextWatcher implements TextWatcher {

        private View view;
        private MyTextWatcher(View view) {
            this.view = view;
        }

        public void beforeTextChanged(CharSequence charSequence, int i, int i1, int i2) {
        }

        public void onTextChanged(CharSequence charSequence, int i, int i1, int i2) {
        }

        public void afterTextChanged(Editable editable) {
            switch (view.getId()) {
                case R.id.input_name:
                    validateName();
                    break;
                case R.id.input_email:
                    validateEmail();
                    break;
            }
        }
    }
}
</pre><p><strong>13</strong>. Open <strong>AndroidManifest.xml</strong> and make <strong>LoginActivity</strong> as <strong>Launcher</strong> activity.</p><p>Now run the app and verify the rest api call by submitting the form.</p><div class="image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-login-screen.png" alt="android-realtime-chat-app-login-screen" width="720" height="773" class="alignnone size-full wp-image-39052" srcset="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-login-screen-279x300.png 279w, http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-login-screen.png 720w" sizes="(max-width: 720px) 100vw, 720px" /><noscript><img src="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-login-screen.png" alt="android-realtime-chat-app-login-screen" width="720" height="773" class="alignnone size-full wp-image-39052" srcset="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-login-screen-279x300.png 279w, http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-login-screen.png 720w" sizes="(max-width: 720px) 100vw, 720px" /></noscript></div><h2>Adding Chat Rooms List Screen</h2><p>The chat rooms will be displayed in a list fashion for which we use RecyclerView. So add the recycler view support to build.gradle.</p><p><strong>14</strong>. Open <strong>build.gradle</strong> and add the <a href="http://www.androidhive.info/2016/01/android-working-with-recycler-view/" target="_blank">RecyclerView</a> dependency and rebuild the project.</p><p><strong>compile &#8216;com.android.support:recyclerview-v7:23.1.1&#8217;</strong></p><p>Below are the final dependencies of my build.gradle</p><pre class="brush: php; title: build.gradle; notranslate" title="build.gradle">
dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    testCompile 'junit:junit:4.12'
    compile 'com.android.support:appcompat-v7:23.1.1'
    compile 'com.android.support:design:23.1.1'
    compile 'com.mcxiaoke.volley:library-aar:1.0.0'
    compile 'com.android.support:recyclerview-v7:23.1.1'
    compile &quot;com.google.android.gms:play-services:8.3.0&quot;
}
</pre><p><strong>15</strong>. Create a layout named <strong>chat_rooms_list_row.xml</strong>. This layout renders a single chat room information like chat room <strong>name</strong>, <strong>last message</strong>, <strong>unread message count</strong> and the <strong>timestamp</strong> in the recycler view.</p><pre class="brush: xml; title: chat_rooms_list_row; notranslate" title="chat_rooms_list_row">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;
    android:paddingBottom=&quot;16dp&quot;
    android:paddingLeft=&quot;16dp&quot;
    android:paddingRight=&quot;16dp&quot;
    android:paddingTop=&quot;16dp&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/name&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentTop=&quot;true&quot;
        android:textColor=&quot;#444444&quot;
        android:textStyle=&quot;bold&quot;
        android:textSize=&quot;16dp&quot; /&gt;

    &lt;TextView android:id=&quot;@+id/message&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_below=&quot;@id/name&quot;
        android:textColor=&quot;#888888&quot;
        android:layout_marginTop=&quot;5dp&quot;
        android:text=&quot;Seems gcm will take some time&quot;/&gt;

    &lt;TextView android:id=&quot;@+id/timestamp&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:text=&quot;12:00 AM&quot;
        android:textSize=&quot;10dp&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:layout_alignParentTop=&quot;true&quot;/&gt;

    &lt;TextView android:id=&quot;@+id/count&quot;
        android:layout_width=&quot;20dp&quot;
        android:layout_height=&quot;20dp&quot;
        android:gravity=&quot;center&quot;
        android:textSize=&quot;10dp&quot;
        android:textColor=&quot;@android:color/white&quot;
        android:layout_below=&quot;@id/timestamp&quot;
        android:layout_marginTop=&quot;5dp&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:text=&quot;5&quot;
        android:background=&quot;@drawable/bg_circle&quot;/&gt;

&lt;/RelativeLayout&gt;
</pre><p><strong>16</strong>. Create a new package named <strong>adapter</strong>. Under adapter create a class named <strong>ChatRoomsAdapter.java</strong>. This is a recycler view adapter which provides data to chat rooms list view.</p><pre class="brush: java; title: ChatRoomsAdapter.java; notranslate" title="ChatRoomsAdapter.java">
package info.androidhive.gcm.adapter;

import android.content.Context;
import android.support.v7.widget.RecyclerView;
import android.view.GestureDetector;
import android.view.LayoutInflater;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;

import info.androidhive.gcm.R;
import info.androidhive.gcm.model.ChatRoom;


public class ChatRoomsAdapter extends RecyclerView.Adapter&lt;ChatRoomsAdapter.ViewHolder&gt; {

    private Context mContext;
    private ArrayList&lt;ChatRoom&gt; chatRoomArrayList;
    private static String today;

    public class ViewHolder extends RecyclerView.ViewHolder {
        public TextView name, message, timestamp, count;

        public ViewHolder(View view) {
            super(view);
            name = (TextView) view.findViewById(R.id.name);
            message = (TextView) view.findViewById(R.id.message);
            timestamp = (TextView) view.findViewById(R.id.timestamp);
            count = (TextView) view.findViewById(R.id.count);
        }
    }


    public ChatRoomsAdapter(Context mContext, ArrayList&lt;ChatRoom&gt; chatRoomArrayList) {
        this.mContext = mContext;
        this.chatRoomArrayList = chatRoomArrayList;

        Calendar calendar = Calendar.getInstance();
        today = String.valueOf(calendar.get(Calendar.DAY_OF_MONTH));
    }

    @Override
    public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
        View itemView = LayoutInflater.from(parent.getContext())
                .inflate(R.layout.chat_rooms_list_row, parent, false);

        return new ViewHolder(itemView);
    }

    @Override
    public void onBindViewHolder(ViewHolder holder, int position) {
        ChatRoom chatRoom = chatRoomArrayList.get(position);
        holder.name.setText(chatRoom.getName());
        holder.message.setText(chatRoom.getLastMessage());
        if (chatRoom.getUnreadCount() &gt; 0) {
            holder.count.setText(String.valueOf(chatRoom.getUnreadCount()));
            holder.count.setVisibility(View.VISIBLE);
        } else {
            holder.count.setVisibility(View.GONE);
        }

        holder.timestamp.setText(getTimeStamp(chatRoom.getTimestamp()));
    }

    @Override
    public int getItemCount() {
        return chatRoomArrayList.size();
    }

    public static String getTimeStamp(String dateStr) {
        SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
        String timestamp = &quot;&quot;;

        today = today.length() &lt; 2 ? &quot;0&quot; + today : today;

        try {
            Date date = format.parse(dateStr);
            SimpleDateFormat todayFormat = new SimpleDateFormat(&quot;dd&quot;);
            String dateToday = todayFormat.format(date);
            format = dateToday.equals(today) ? new SimpleDateFormat(&quot;hh:mm a&quot;) : new SimpleDateFormat(&quot;dd LLL, hh:mm a&quot;);
            String date1 = format.format(date);
            timestamp = date1.toString();
        } catch (ParseException e) {
            e.printStackTrace();
        }

        return timestamp;
    }

    public interface ClickListener {
        void onClick(View view, int position);

        void onLongClick(View view, int position);
    }

    public static class RecyclerTouchListener implements RecyclerView.OnItemTouchListener {

        private GestureDetector gestureDetector;
        private ChatRoomsAdapter.ClickListener clickListener;

        public RecyclerTouchListener(Context context, final RecyclerView recyclerView, final ChatRoomsAdapter.ClickListener clickListener) {
            this.clickListener = clickListener;
            gestureDetector = new GestureDetector(context, new GestureDetector.SimpleOnGestureListener() {
                @Override
                public boolean onSingleTapUp(MotionEvent e) {
                    return true;
                }

                @Override
                public void onLongPress(MotionEvent e) {
                    View child = recyclerView.findChildViewUnder(e.getX(), e.getY());
                    if (child != null &amp;&amp; clickListener != null) {
                        clickListener.onLongClick(child, recyclerView.getChildPosition(child));
                    }
                }
            });
        }

        @Override
        public boolean onInterceptTouchEvent(RecyclerView rv, MotionEvent e) {

            View child = rv.findChildViewUnder(e.getX(), e.getY());
            if (child != null &amp;&amp; clickListener != null &amp;&amp; gestureDetector.onTouchEvent(e)) {
                clickListener.onClick(child, rv.getChildPosition(child));
            }
            return false;
        }

        @Override
        public void onTouchEvent(RecyclerView rv, MotionEvent e) {
        }

        @Override
        public void onRequestDisallowInterceptTouchEvent(boolean disallowIntercept) {

        }
    }
}
</pre><p><strong>17</strong>. Open <strong>MyGcmPushReceiver.java</strong> and modify the code as below. Here I have added few methods to handle push notification message. First the push notification will be identified by <strong>flag</strong> node and then appropriate action will be taken.</p><p><strong>></strong> <strong>processChatRoomPush()</strong> method will be called whenever chat room push message is received</p><p><strong>></strong> <strong>processUserMessage()</strong> will be called when the push is specific to logged in user.</p><pre class="brush: java; title: MyGcmPushReceiver.java; notranslate" title="MyGcmPushReceiver.java">
package info.androidhive.gcm.gcm;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.support.v4.content.LocalBroadcastManager;
import android.text.TextUtils;
import android.util.Log;
import android.widget.Toast;

import com.google.android.gms.gcm.GcmListenerService;

import org.json.JSONException;
import org.json.JSONObject;

import info.androidhive.gcm.activity.ChatRoomActivity;
import info.androidhive.gcm.activity.MainActivity;
import info.androidhive.gcm.app.Config;
import info.androidhive.gcm.app.MyApplication;
import info.androidhive.gcm.model.Message;
import info.androidhive.gcm.model.User;

public class MyGcmPushReceiver extends GcmListenerService {

    private static final String TAG = MyGcmPushReceiver.class.getSimpleName();

    private NotificationUtils notificationUtils;

    /**
     * Called when message is received.
     *
     * @param from   SenderID of the sender.
     * @param bundle Data bundle containing message data as key/value pairs.
     *               For Set of keys use data.keySet().
     */

    @Override
    public void onMessageReceived(String from, Bundle bundle) {
        String title = bundle.getString(&quot;title&quot;);
        Boolean isBackground = Boolean.valueOf(bundle.getString(&quot;is_background&quot;));
        String flag = bundle.getString(&quot;flag&quot;);
        String data = bundle.getString(&quot;data&quot;);
        Log.d(TAG, &quot;From: &quot; + from);
        Log.d(TAG, &quot;title: &quot; + title);
        Log.d(TAG, &quot;isBackground: &quot; + isBackground);
        Log.d(TAG, &quot;flag: &quot; + flag);
        Log.d(TAG, &quot;data: &quot; + data);

        if (flag == null)
            return;

        if(MyApplication.getInstance().getPrefManager().getUser() == null){
            // user is not logged in, skipping push notification
            Log.e(TAG, &quot;user is not logged in, skipping push notification&quot;);
            return;
        }

        if (from.startsWith(&quot;/topics/&quot;)) {
            // message received from some topic.
        } else {
            // normal downstream message.
        }

        switch (Integer.parseInt(flag)) {
            case Config.PUSH_TYPE_CHATROOM:
                // push notification belongs to a chat room
                processChatRoomPush(title, isBackground, data);
                break;
            case Config.PUSH_TYPE_USER:
                // push notification is specific to user
                processUserMessage(title, isBackground, data);
                break;
        }
    }

    /**
     * Processing chat room push message
     * this message will be broadcasts to all the activities registered
     * */
    private void processChatRoomPush(String title, boolean isBackground, String data) {
        if (!isBackground) {

            try {
                JSONObject datObj = new JSONObject(data);

                String chatRoomId = datObj.getString(&quot;chat_room_id&quot;);

                JSONObject mObj = datObj.getJSONObject(&quot;message&quot;);
                Message message = new Message();
                message.setMessage(mObj.getString(&quot;message&quot;));
                message.setId(mObj.getString(&quot;message_id&quot;));
                message.setCreatedAt(mObj.getString(&quot;created_at&quot;));

                JSONObject uObj = datObj.getJSONObject(&quot;user&quot;);

                // skip the message if the message belongs to same user as
                // the user would be having the same message when he was sending
                // but it might differs in your scenario
                if (uObj.getString(&quot;user_id&quot;).equals(MyApplication.getInstance().getPrefManager().getUser().getId())) {
                    Log.e(TAG, &quot;Skipping the push message as it belongs to same user&quot;);
                    return;
                }

                User user = new User();
                user.setId(uObj.getString(&quot;user_id&quot;));
                user.setEmail(uObj.getString(&quot;email&quot;));
                user.setName(uObj.getString(&quot;name&quot;));
                message.setUser(user);

                // verifying whether the app is in background or foreground
                if (!NotificationUtils.isAppIsInBackground(getApplicationContext())) {

                    // app is in foreground, broadcast the push message
                    Intent pushNotification = new Intent(Config.PUSH_NOTIFICATION);
                    pushNotification.putExtra(&quot;type&quot;, Config.PUSH_TYPE_CHATROOM);
                    pushNotification.putExtra(&quot;message&quot;, message);
                    pushNotification.putExtra(&quot;chat_room_id&quot;, chatRoomId);
                    LocalBroadcastManager.getInstance(this).sendBroadcast(pushNotification);

                    // play notification sound
                    NotificationUtils notificationUtils = new NotificationUtils();
                    notificationUtils.playNotificationSound();
                } else {

                    // app is in background. show the message in notification try
                    Intent resultIntent = new Intent(getApplicationContext(), ChatRoomActivity.class);
                    resultIntent.putExtra(&quot;chat_room_id&quot;, chatRoomId);
                    showNotificationMessage(getApplicationContext(), title, user.getName() + &quot; : &quot; + message.getMessage(), message.getCreatedAt(), resultIntent);
                }

            } catch (JSONException e) {
                Log.e(TAG, &quot;json parsing error: &quot; + e.getMessage());
                Toast.makeText(getApplicationContext(), &quot;Json parse error: &quot; + e.getMessage(), Toast.LENGTH_LONG).show();
            }

        } else {
            // the push notification is silent, may be other operations needed
            // like inserting it in to SQLite
        }
    }

    /**
     * Processing user specific push message
     * It will be displayed with / without image in push notification tray
     * */
    private void processUserMessage(String title, boolean isBackground, String data) {
        if (!isBackground) {

            try {
                JSONObject datObj = new JSONObject(data);

                String imageUrl = datObj.getString(&quot;image&quot;);

                JSONObject mObj = datObj.getJSONObject(&quot;message&quot;);
                Message message = new Message();
                message.setMessage(mObj.getString(&quot;message&quot;));
                message.setId(mObj.getString(&quot;message_id&quot;));
                message.setCreatedAt(mObj.getString(&quot;created_at&quot;));

                JSONObject uObj = datObj.getJSONObject(&quot;user&quot;);
                User user = new User();
                user.setId(uObj.getString(&quot;user_id&quot;));
                user.setEmail(uObj.getString(&quot;email&quot;));
                user.setName(uObj.getString(&quot;name&quot;));
                message.setUser(user);

                // verifying whether the app is in background or foreground
                if (!NotificationUtils.isAppIsInBackground(getApplicationContext())) {

                    // app is in foreground, broadcast the push message
                    Intent pushNotification = new Intent(Config.PUSH_NOTIFICATION);
                    pushNotification.putExtra(&quot;type&quot;, Config.PUSH_TYPE_USER);
                    pushNotification.putExtra(&quot;message&quot;, message);
                    LocalBroadcastManager.getInstance(this).sendBroadcast(pushNotification);

                    // play notification sound
                    NotificationUtils notificationUtils = new NotificationUtils();
                    notificationUtils.playNotificationSound();
                } else {

                    // app is in background. show the message in notification try
                    Intent resultIntent = new Intent(getApplicationContext(), MainActivity.class);

                    // check for push notification image attachment
                    if (TextUtils.isEmpty(imageUrl)) {
                        showNotificationMessage(getApplicationContext(), title, user.getName() + &quot; : &quot; + message.getMessage(), message.getCreatedAt(), resultIntent);
                    } else {
                        // push notification contains image
                        // show it with the image
                        showNotificationMessageWithBigImage(getApplicationContext(), title, message.getMessage(), message.getCreatedAt(), resultIntent, imageUrl);
                    }
                }
            } catch (JSONException e) {
                Log.e(TAG, &quot;json parsing error: &quot; + e.getMessage());
                Toast.makeText(getApplicationContext(), &quot;Json parse error: &quot; + e.getMessage(), Toast.LENGTH_LONG).show();
            }

        } else {
            // the push notification is silent, may be other operations needed
            // like inserting it in to SQLite
        }
    }

    /**
     * Showing notification with text only
     * */
    private void showNotificationMessage(Context context, String title, String message, String timeStamp, Intent intent) {
        notificationUtils = new NotificationUtils(context);
        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
        notificationUtils.showNotificationMessage(title, message, timeStamp, intent);
    }

    /**
     * Showing notification with text and image
     * */
    private void showNotificationMessageWithBigImage(Context context, String title, String message, String timeStamp, Intent intent, String imageUrl) {
        notificationUtils = new NotificationUtils(context);
        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
        notificationUtils.showNotificationMessage(title, message, timeStamp, intent, imageUrl);
    }
}
</pre><p><strong>18</strong>. Create an xml layout named <strong>line_divider.xml</strong> inside <strong>drawable</strong> folder.</p><div style="float:none;margin:10px 0 10px 0;text-align:center;"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>  <ins class="adsbygoogle"
style="display:inline-block;width:300px;height:250px"
data-ad-client="ca-pub-9207768510467156"
data-ad-slot="2887095024"></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div><pre class="brush: xml; title: ; notranslate" title="">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:shape=&quot;rectangle&quot;&gt;

    &lt;size
        android:width=&quot;1dp&quot;
        android:height=&quot;1dp&quot; /&gt;

    &lt;solid android:color=&quot;@color/list_divider&quot; /&gt;

&lt;/shape&gt;
</pre><p><strong>19</strong>. Create an xml file named <strong>bg_circle.xml</strong> inside <strong>drawable</strong> folder. This layout acts as circular background for unread message count.</p><pre class="brush: xml; title: bg_circle.xml; notranslate" title="bg_circle.xml">
&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;

    &lt;solid android:color=&quot;@color/colorPrimary&quot; /&gt;

    &lt;corners
        android:bottomLeftRadius=&quot;20dp&quot;
        android:bottomRightRadius=&quot;20dp&quot;
        android:topLeftRadius=&quot;20dp&quot;
        android:topRightRadius=&quot;20dp&quot; /&gt;

&lt;/shape&gt;
</pre><p><strong>20</strong>. Under helper package, create <strong>SimpleDividerItemDecoration.java</strong>. This class helps in adding a separator to recycler view items.</p><pre class="brush: java; title: SimpleDividerItemDecoration.java; notranslate" title="SimpleDividerItemDecoration.java">
package info.androidhive.gcm.helper;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.drawable.Drawable;
import android.support.v4.content.ContextCompat;
import android.support.v7.widget.RecyclerView;
import android.view.View;

import info.androidhive.gcm.R;

/**
 * Created by Lincoln on 30/10/15.
 */
public class SimpleDividerItemDecoration extends RecyclerView.ItemDecoration {
    private Drawable mDivider;

    public SimpleDividerItemDecoration(Context context) {
        mDivider = ContextCompat.getDrawable(context, R.drawable.line_divider);
    }

    @Override
    public void onDrawOver(Canvas c, RecyclerView parent, RecyclerView.State state) {
        int left = parent.getPaddingLeft();
        int right = parent.getWidth() - parent.getPaddingRight();

        int childCount = parent.getChildCount();
        for (int i = 0; i &lt; childCount; i++) {
            View child = parent.getChildAt(i);

            RecyclerView.LayoutParams params = (RecyclerView.LayoutParams) child.getLayoutParams();

            int top = child.getBottom() + params.bottomMargin;
            int bottom = top + mDivider.getIntrinsicHeight();

            mDivider.setBounds(left, top, right, bottom);
            mDivider.draw(c);
        }
    }
}
</pre><p><strong>21</strong>. Open <strong>menu_main.xml</strong> located under <strong>res menu</strong> and add a logout menu item to provide logout option to user.</p><pre class="brush: xml; title: menu_main.xml; notranslate" title="menu_main.xml">
&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    tools:context=&quot;.activity.MainActivity&quot;&gt;
    &lt;item
        android:id=&quot;@+id/action_logout&quot;
        android:orderInCategory=&quot;100&quot;
        android:title=&quot;@string/action_logout&quot;
        app:showAsAction=&quot;never&quot; /&gt;
&lt;/menu&gt;
</pre><p><strong>22</strong>. Open <strong>content_main.xml</strong> and add the recycler view element.</p><pre class="brush: xml; title: content_main.xml; notranslate" title="content_main.xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;
    tools:showIn=&quot;@layout/activity_main&quot;
    tools:context=&quot;.activity.MainActivity&quot;&gt;

    &lt;android.support.v7.widget.RecyclerView
        android:id=&quot;@+id/recycler_view&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:scrollbars=&quot;vertical&quot; /&gt;
&lt;/RelativeLayout&gt;

</pre><p><strong>23</strong>. Finally open <strong>MainActivity.java</strong> and modify the code as below. Here</p><p><strong>></strong> First user session is checked before setting the content view.</p><p><strong>></strong> On receiving the gcm registration token, user is subscribed to <strong>`global`</strong> topic. This allows us to send a notification to all the users from the admin panel.</p><p><strong>></strong> <strong>fetchChatRooms()</strong> is called in <strong>onCreate()</strong> method which fetches all the chat room information from the server. Once the chat rooms are received, user will be automatically <strong>subscribed to all the chat rooms topics</strong>. So that he will start receiving notifications whenever there is a active discussion going on in a chatroom.</p><p><strong>></strong> Broadcast receivers are registered / unregistered in <strong>onResume()</strong> / <strong>onPause()</strong> methods.</p><p><strong>></strong> Broadcast receivers will be triggered whenever a new push message is received in which <strong>handlePushNotification()</strong> method is called.</p><p><strong>></strong> <strong>handlePushNotification()</strong> handles the push notification by updating the recycler view items by updating <strong>last message</strong> and <strong>unread message count</strong>.</p><pre class="brush: java; title: MainActivity.java; notranslate" title="MainActivity.java">
package info.androidhive.gcm.activity;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Bundle;
import android.support.v4.content.LocalBroadcastManager;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.DefaultItemAnimator;
import android.support.v7.widget.LinearLayoutManager;
import android.support.v7.widget.RecyclerView;
import android.support.v7.widget.Toolbar;
import android.util.Log;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.widget.Toast;

import com.android.volley.NetworkResponse;
import com.android.volley.Request;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;
import com.google.android.gms.common.ConnectionResult;
import com.google.android.gms.common.GoogleApiAvailability;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.util.ArrayList;

import info.androidhive.gcm.R;
import info.androidhive.gcm.adapter.ChatRoomsAdapter;
import info.androidhive.gcm.app.Config;
import info.androidhive.gcm.app.EndPoints;
import info.androidhive.gcm.app.MyApplication;
import info.androidhive.gcm.gcm.GcmIntentService;
import info.androidhive.gcm.gcm.NotificationUtils;
import info.androidhive.gcm.helper.SimpleDividerItemDecoration;
import info.androidhive.gcm.model.ChatRoom;
import info.androidhive.gcm.model.Message;

public class MainActivity extends AppCompatActivity {

    private String TAG = MainActivity.class.getSimpleName();
    private static final int PLAY_SERVICES_RESOLUTION_REQUEST = 9000;
    private BroadcastReceiver mRegistrationBroadcastReceiver;
    private ArrayList&lt;ChatRoom&gt; chatRoomArrayList;
    private ChatRoomsAdapter mAdapter;
    private RecyclerView recyclerView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        /**
         * Check for login session. If not logged in launch
         * login activity
         * */
        if (MyApplication.getInstance().getPrefManager().getUser() == null) {
            launchLoginActivity();
        }

        setContentView(R.layout.activity_main);
        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        setSupportActionBar(toolbar);

        recyclerView = (RecyclerView) findViewById(R.id.recycler_view);

        /**
         * Broadcast receiver calls in two scenarios
         * 1. gcm registration is completed
         * 2. when new push notification is received
         * */
        mRegistrationBroadcastReceiver = new BroadcastReceiver() {
            @Override
            public void onReceive(Context context, Intent intent) {

                // checking for type intent filter
                if (intent.getAction().equals(Config.REGISTRATION_COMPLETE)) {
                    // gcm successfully registered
                    // now subscribe to `global` topic to receive app wide notifications
                    subscribeToGlobalTopic();

                } else if (intent.getAction().equals(Config.SENT_TOKEN_TO_SERVER)) {
                    // gcm registration id is stored in our server's MySQL
                    Log.e(TAG, &quot;GCM registration id is sent to our server&quot;);

                } else if (intent.getAction().equals(Config.PUSH_NOTIFICATION)) {
                    // new push notification is received
                    handlePushNotification(intent);
                }
            }
        };

        chatRoomArrayList = new ArrayList&lt;&gt;();
        mAdapter = new ChatRoomsAdapter(this, chatRoomArrayList);
        LinearLayoutManager layoutManager = new LinearLayoutManager(this);
        recyclerView.setLayoutManager(layoutManager);
        recyclerView.addItemDecoration(new SimpleDividerItemDecoration(
                getApplicationContext()
        ));
        recyclerView.setItemAnimator(new DefaultItemAnimator());
        recyclerView.setAdapter(mAdapter);

        recyclerView.addOnItemTouchListener(new ChatRoomsAdapter.RecyclerTouchListener(getApplicationContext(), recyclerView, new ChatRoomsAdapter.ClickListener() {
            @Override
            public void onClick(View view, int position) {
                // when chat is clicked, launch full chat thread activity
                ChatRoom chatRoom = chatRoomArrayList.get(position);
                Intent intent = new Intent(MainActivity.this, ChatRoomActivity.class);
                intent.putExtra(&quot;chat_room_id&quot;, chatRoom.getId());
                intent.putExtra(&quot;name&quot;, chatRoom.getName());
                startActivity(intent);
            }

            @Override
            public void onLongClick(View view, int position) {

            }
        }));

        /**
         * Always check for google play services availability before
         * proceeding further with GCM
         * */
        if (checkPlayServices()) {
            registerGCM();
            fetchChatRooms();
        }
    }

    /**
     * Handles new push notification
     */
    private void handlePushNotification(Intent intent) {
        int type = intent.getIntExtra(&quot;type&quot;, -1);

        // if the push is of chat room message
        // simply update the UI unread messages count
        if (type == Config.PUSH_TYPE_CHATROOM) {
            Message message = (Message) intent.getSerializableExtra(&quot;message&quot;);
            String chatRoomId = intent.getStringExtra(&quot;chat_room_id&quot;);

            if (message != null &amp;&amp; chatRoomId != null) {
                updateRow(chatRoomId, message);
            }
        } else if (type == Config.PUSH_TYPE_USER) {
            // push belongs to user alone
            // just showing the message in a toast
            Message message = (Message) intent.getSerializableExtra(&quot;message&quot;);
            Toast.makeText(getApplicationContext(), &quot;New push: &quot; + message.getMessage(), Toast.LENGTH_LONG).show();
        }


    }

    /**
     * Updates the chat list unread count and the last message
     */
    private void updateRow(String chatRoomId, Message message) {
        for (ChatRoom cr : chatRoomArrayList) {
            if (cr.getId().equals(chatRoomId)) {
                int index = chatRoomArrayList.indexOf(cr);
                cr.setLastMessage(message.getMessage());
                cr.setUnreadCount(cr.getUnreadCount() + 1);
                chatRoomArrayList.remove(index);
                chatRoomArrayList.add(index, cr);
                break;
            }
        }
        mAdapter.notifyDataSetChanged();
    }


    /**
     * fetching the chat rooms by making http call
     */
    private void fetchChatRooms() {
        StringRequest strReq = new StringRequest(Request.Method.GET,
                EndPoints.CHAT_ROOMS, new Response.Listener&lt;String&gt;() {

            @Override
            public void onResponse(String response) {
                Log.e(TAG, &quot;response: &quot; + response);

                try {
                    JSONObject obj = new JSONObject(response);

                    // check for error flag
                    if (obj.getBoolean(&quot;error&quot;) == false) {
                        JSONArray chatRoomsArray = obj.getJSONArray(&quot;chat_rooms&quot;);
                        for (int i = 0; i &lt; chatRoomsArray.length(); i++) {
                            JSONObject chatRoomsObj = (JSONObject) chatRoomsArray.get(i);
                            ChatRoom cr = new ChatRoom();
                            cr.setId(chatRoomsObj.getString(&quot;chat_room_id&quot;));
                            cr.setName(chatRoomsObj.getString(&quot;name&quot;));
                            cr.setLastMessage(&quot;&quot;);
                            cr.setUnreadCount(0);
                            cr.setTimestamp(chatRoomsObj.getString(&quot;created_at&quot;));

                            chatRoomArrayList.add(cr);
                        }

                    } else {
                        // error in fetching chat rooms
                        Toast.makeText(getApplicationContext(), &quot;&quot; + obj.getJSONObject(&quot;error&quot;).getString(&quot;message&quot;), Toast.LENGTH_LONG).show();
                    }

                } catch (JSONException e) {
                    Log.e(TAG, &quot;json parsing error: &quot; + e.getMessage());
                    Toast.makeText(getApplicationContext(), &quot;Json parse error: &quot; + e.getMessage(), Toast.LENGTH_LONG).show();
                }

                mAdapter.notifyDataSetChanged();

                // subscribing to all chat room topics
                subscribeToAllTopics();
            }
        }, new Response.ErrorListener() {

            @Override
            public void onErrorResponse(VolleyError error) {
                NetworkResponse networkResponse = error.networkResponse;
                Log.e(TAG, &quot;Volley error: &quot; + error.getMessage() + &quot;, code: &quot; + networkResponse);
                Toast.makeText(getApplicationContext(), &quot;Volley error: &quot; + error.getMessage(), Toast.LENGTH_SHORT).show();
            }
        });

        //Adding request to request queue
        MyApplication.getInstance().addToRequestQueue(strReq);
    }

    // subscribing to global topic
    private void subscribeToGlobalTopic() {
        Intent intent = new Intent(this, GcmIntentService.class);
        intent.putExtra(GcmIntentService.KEY, GcmIntentService.SUBSCRIBE);
        intent.putExtra(GcmIntentService.TOPIC, Config.TOPIC_GLOBAL);
        startService(intent);
    }

    // Subscribing to all chat room topics
    // each topic name starts with `topic_` followed by the ID of the chat room
    // Ex: topic_1, topic_2
    private void subscribeToAllTopics() {
        for (ChatRoom cr : chatRoomArrayList) {

            Intent intent = new Intent(this, GcmIntentService.class);
            intent.putExtra(GcmIntentService.KEY, GcmIntentService.SUBSCRIBE);
            intent.putExtra(GcmIntentService.TOPIC, &quot;topic_&quot; + cr.getId());
            startService(intent);
        }
    }

    private void launchLoginActivity() {
        Intent intent = new Intent(MainActivity.this, LoginActivity.class);
        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
        startActivity(intent);
        finish();
    }

    @Override
    protected void onResume() {
        super.onResume();

        // register GCM registration complete receiver
        LocalBroadcastManager.getInstance(this).registerReceiver(mRegistrationBroadcastReceiver,
                new IntentFilter(Config.REGISTRATION_COMPLETE));

        // register new push message receiver
        // by doing this, the activity will be notified each time a new message arrives
        LocalBroadcastManager.getInstance(this).registerReceiver(mRegistrationBroadcastReceiver,
                new IntentFilter(Config.PUSH_NOTIFICATION));

        // clearing the notification tray
        NotificationUtils.clearNotifications();
    }

    @Override
    protected void onPause() {
        LocalBroadcastManager.getInstance(this).unregisterReceiver(mRegistrationBroadcastReceiver);
        super.onPause();
    }

    // starting the service to register with GCM
    private void registerGCM() {
        Intent intent = new Intent(this, GcmIntentService.class);
        intent.putExtra(&quot;key&quot;, &quot;register&quot;);
        startService(intent);
    }

    private boolean checkPlayServices() {
        GoogleApiAvailability apiAvailability = GoogleApiAvailability.getInstance();
        int resultCode = apiAvailability.isGooglePlayServicesAvailable(this);
        if (resultCode != ConnectionResult.SUCCESS) {
            if (apiAvailability.isUserResolvableError(resultCode)) {
                apiAvailability.getErrorDialog(this, resultCode, PLAY_SERVICES_RESOLUTION_REQUEST)
                        .show();
            } else {
                Log.i(TAG, &quot;This device is not supported. Google Play Services not installed!&quot;);
                Toast.makeText(getApplicationContext(), &quot;This device is not supported. Google Play Services not installed!&quot;, Toast.LENGTH_LONG).show();
                finish();
            }
            return false;
        }
        return true;
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        MenuInflater inflater = getMenuInflater();
        inflater.inflate(R.menu.menu_main, menu);
        return true;
    }

    public boolean onOptionsItemSelected(MenuItem menuItem) {
        switch (menuItem.getItemId()) {
            case R.id.action_logout:
                MyApplication.getInstance().logout();
                break;
        }
        return super.onOptionsItemSelected(menuItem);
    }
}
</pre><p>Now deploy the app into two devices / emulators in order to test the push notifications. You can also use the server app admin panel by visiting <a rel="nofollow" href="http://localhost/gcm_chat" target="_blank">http://localhost/gcm_chat</a> and type a message in a chat room.</p><div class="image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://www.androidhive.info/wp-content/uploads/2016/02/android-simple-realtime-chat-app-using-gcm-android-php-mysql.png" alt="android realtime chat app login screen" width="720" height="774" class="alignnone size-full wp-image-39051" srcset="http://www.androidhive.info/wp-content/uploads/2016/02/android-simple-realtime-chat-app-using-gcm-android-php-mysql-279x300.png 279w, http://www.androidhive.info/wp-content/uploads/2016/02/android-simple-realtime-chat-app-using-gcm-android-php-mysql.png 720w" sizes="(max-width: 720px) 100vw, 720px" /><noscript><img src="http://www.androidhive.info/wp-content/uploads/2016/02/android-simple-realtime-chat-app-using-gcm-android-php-mysql.png" alt="android realtime chat app login screen" width="720" height="774" class="alignnone size-full wp-image-39051" srcset="http://www.androidhive.info/wp-content/uploads/2016/02/android-simple-realtime-chat-app-using-gcm-android-php-mysql-279x300.png 279w, http://www.androidhive.info/wp-content/uploads/2016/02/android-simple-realtime-chat-app-using-gcm-android-php-mysql.png 720w" sizes="(max-width: 720px) 100vw, 720px" /></noscript></div><h2>Adding Single Chat Room Thread</h2><p>The single chat room thread screen contains the messages from different users aligned left or right on the screen. All the messages belongs to other users will be aligned to left. The messages belongs to current logged in user will be aligned to right.</p><p>This alignment can be achieved using a recycler view and two different xml layouts for self and other messages.</p><p><strong>24</strong>. Create an xml file named <strong>bg_bubble_white.xml</strong> inside <strong>drawable</strong> folder. This layout adds a rounded corner background to other&#8217;s messages.</p><pre class="brush: xml; title: bg_bubble_white.xml; notranslate" title="bg_bubble_white.xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;shape
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:shape=&quot;rectangle&quot;&gt;

    &lt;!-- view background color --&gt;
    &lt;solid
        android:color=&quot;@android:color/white&quot; &gt;
    &lt;/solid&gt;



    &lt;!-- If you want to add some padding --&gt;
    &lt;padding
        android:left=&quot;10dp&quot;
        android:top=&quot;4dp&quot;
        android:right=&quot;10dp&quot;
        android:bottom=&quot;4dp&quot;    &gt;
    &lt;/padding&gt;

    &lt;!-- Here is the corner radius --&gt;
    &lt;corners
        android:radius=&quot;5dp&quot;   &gt;
    &lt;/corners&gt;

&lt;/shape&gt;
</pre><p><strong>25</strong>. Create an xml file named <strong>bg_bubble_gray.xml</strong> inside <strong>drawable</strong> folder. This layout adds a rounded corner background to self messages.</p><pre class="brush: xml; title: bg_bubble_gray.xml; notranslate" title="bg_bubble_gray.xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;shape
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:shape=&quot;rectangle&quot;&gt;

    &lt;!-- view background color --&gt;
    &lt;solid
        android:color=&quot;@color/bg_bubble_self&quot; &gt;
    &lt;/solid&gt;



    &lt;!-- If you want to add some padding --&gt;
    &lt;padding
        android:left=&quot;10dp&quot;
        android:top=&quot;4dp&quot;
        android:right=&quot;10dp&quot;
        android:bottom=&quot;4dp&quot;    &gt;
    &lt;/padding&gt;

    &lt;!-- Here is the corner radius --&gt;
    &lt;corners
        android:radius=&quot;5dp&quot;   &gt;
    &lt;/corners&gt;

&lt;/shape&gt;
</pre><p><strong>26</strong>. Create two xml layouts named <strong>chat_item_self.xml</strong> and <strong>chat_item_other.xml</strong> to render both self and other messages.</p><pre class="brush: xml; title: chat_item_self.xml; notranslate" title="chat_item_self.xml">
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:gravity=&quot;right&quot;
    android:orientation=&quot;horizontal&quot;
    android:paddingBottom=&quot;5dp&quot;
    android:paddingLeft=&quot;16dp&quot;
    android:paddingRight=&quot;16dp&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/message&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:layout_marginRight=&quot;10dp&quot;
        android:textIsSelectable=&quot;true&quot;
        android:background=&quot;@drawable/bg_bubble_gray&quot;
        android:textSize=&quot;14dp&quot; /&gt;

    &lt;TextView
        android:id=&quot;@+id/timestamp&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignRight=&quot;@id/message&quot;
        android:layout_below=&quot;@id/message&quot;
        android:layout_marginBottom=&quot;25dp&quot;
        android:padding=&quot;10dp&quot;
        android:textSize=&quot;10dp&quot; /&gt;

&lt;/RelativeLayout&gt;
</pre><pre class="brush: xml; title: chat_item_other.xml; notranslate" title="chat_item_other.xml">
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;horizontal&quot;
    android:paddingTop=&quot;5dp&quot;
    android:paddingLeft=&quot;16dp&quot;
    android:paddingRight=&quot;16dp&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/message&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_marginLeft=&quot;10dp&quot;
        android:textIsSelectable=&quot;true&quot;
        android:background=&quot;@drawable/bg_bubble_white&quot;
        android:textSize=&quot;14dp&quot; /&gt;

    &lt;TextView
        android:id=&quot;@+id/timestamp&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_below=&quot;@id/message&quot;
        android:layout_marginBottom=&quot;25dp&quot;
        android:layout_marginLeft=&quot;10dp&quot;
        android:paddingLeft=&quot;10dp&quot;
        android:paddingTop=&quot;6dp&quot;
        android:textSize=&quot;10dp&quot; /&gt;
&lt;/RelativeLayout&gt;
</pre><p><strong>27</strong>. Create a class named <strong>ChatRoomThreadAdapter.java</strong> under <strong>adapter</strong> package.</p><pre class="brush: java; title: ChatRoomThreadAdapter.java; notranslate" title="ChatRoomThreadAdapter.java"> This adapter class identifies the current logged in user messages by user id and align the messages left or right by inflating two different xml layouts.
package info.androidhive.gcm.adapter;

import android.content.Context;
import android.support.v7.widget.RecyclerView;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;

import info.androidhive.gcm.R;
import info.androidhive.gcm.model.Message;

public class ChatRoomThreadAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; {

    private static String TAG = ChatRoomThreadAdapter.class.getSimpleName();

    private String userId;
    private int SELF = 100;
    private static String today;

    private Context mContext;
    private ArrayList&lt;Message&gt; messageArrayList;

    public class ViewHolder extends RecyclerView.ViewHolder {
        TextView message, timestamp;

        public ViewHolder(View view) {
            super(view);
            message = (TextView) itemView.findViewById(R.id.message);
            timestamp = (TextView) itemView.findViewById(R.id.timestamp);
        }
    }


    public ChatRoomThreadAdapter(Context mContext, ArrayList&lt;Message&gt; messageArrayList, String userId) {
        this.mContext = mContext;
        this.messageArrayList = messageArrayList;
        this.userId = userId;

        Calendar calendar = Calendar.getInstance();
        today = String.valueOf(calendar.get(Calendar.DAY_OF_MONTH));
    }

    @Override
    public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
        View itemView;

        // view type is to identify where to render the chat message
        // left or right
        if (viewType == SELF) {
            // self message
            itemView = LayoutInflater.from(parent.getContext())
                    .inflate(R.layout.chat_item_self, parent, false);
        } else {
            // others message
            itemView = LayoutInflater.from(parent.getContext())
                    .inflate(R.layout.chat_item_other, parent, false);
        }


        return new ViewHolder(itemView);
    }


    @Override
    public int getItemViewType(int position) {
        Message message = messageArrayList.get(position);
        if (message.getUser().getId().equals(userId)) {
            return SELF;
        }

        return position;
    }

    @Override
    public void onBindViewHolder(final RecyclerView.ViewHolder holder, int position) {
        Message message = messageArrayList.get(position);
        ((ViewHolder) holder).message.setText(message.getMessage());

        String timestamp = getTimeStamp(message.getCreatedAt());

        if (message.getUser().getName() != null)
            timestamp = message.getUser().getName() + &quot;, &quot; + timestamp;

        ((ViewHolder) holder).timestamp.setText(timestamp);
    }

    @Override
    public int getItemCount() {
        return messageArrayList.size();
    }

    public static String getTimeStamp(String dateStr) {
        SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
        String timestamp = &quot;&quot;;

        today = today.length() &lt; 2 ? &quot;0&quot; + today : today;

        try {
            Date date = format.parse(dateStr);
            SimpleDateFormat todayFormat = new SimpleDateFormat(&quot;dd&quot;);
            String dateToday = todayFormat.format(date);
            format = dateToday.equals(today) ? new SimpleDateFormat(&quot;hh:mm a&quot;) : new SimpleDateFormat(&quot;dd LLL, hh:mm a&quot;);
            String date1 = format.format(date);
            timestamp = date1.toString();
        } catch (ParseException e) {
            e.printStackTrace();
        }
        return timestamp;
    }
}
</pre><p><strong>28</strong>. Create a new activity class named <strong>ChatRoomActivity.java</strong> by right clicking on <strong>activity  New  Activity  Blank Activity</strong>. This creates two layout files named <strong>activity_chat_room.xml</strong> and <strong>content_chat_room.xml</strong>.</p><pre class="brush: xml; title: activity_chat_room.xml; notranslate" title="activity_chat_room.xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;android.support.design.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:fitsSystemWindows=&quot;true&quot;
    tools:context=&quot;.activity.ChatRoomActivity&quot;&gt;

    &lt;android.support.design.widget.AppBarLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:theme=&quot;@style/AppTheme.AppBarOverlay&quot;&gt;

        &lt;android.support.v7.widget.Toolbar
            android:id=&quot;@+id/toolbar&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;?attr/actionBarSize&quot;
            android:background=&quot;?attr/colorPrimary&quot;
            app:popupTheme=&quot;@style/AppTheme.PopupOverlay&quot; /&gt;

    &lt;/android.support.design.widget.AppBarLayout&gt;

    &lt;include layout=&quot;@layout/content_chat_room&quot; /&gt;

&lt;/android.support.design.widget.CoordinatorLayout&gt;
</pre><p><strong>29</strong>. Open <strong>content_chat_room.xml</strong> and add the below code. Here I have added a recycler view and an EditText element to enter the new message in a chat room.</p><pre class="brush: xml; title: content_chat_room.xml; notranslate" title="content_chat_room.xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;
    tools:context=&quot;.activity.ChatRoomActivity&quot;
    tools:showIn=&quot;@layout/activity_chat_room&quot;&gt;

    &lt;android.support.v7.widget.RecyclerView
        android:id=&quot;@+id/recycler_view&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:paddingBottom=&quot;20dp&quot;
        android:scrollbars=&quot;vertical&quot; /&gt;

    &lt;LinearLayout
        android:background=&quot;@android:color/white&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentBottom=&quot;true&quot;
        android:orientation=&quot;horizontal&quot;
        android:weightSum=&quot;4&quot;&gt;

        &lt;EditText android:id=&quot;@+id/message&quot;
            android:layout_width=&quot;0dp&quot;
            android:hint=&quot;Enter message&quot;
            android:paddingLeft=&quot;10dp&quot;
            android:background=&quot;@null&quot;
            android:layout_marginRight=&quot;10dp&quot;
            android:layout_marginLeft=&quot;16dp&quot;
            android:lines=&quot;1&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_weight=&quot;3&quot; /&gt;

        &lt;Button android:id=&quot;@+id/btn_send&quot;
            android:layout_width=&quot;0dp&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_weight=&quot;1&quot;
            android:background=&quot;@null&quot;
            android:text=&quot;SEND&quot;
            android:textSize=&quot;16dp&quot;
            android:textColor=&quot;@color/colorPrimary&quot; /&gt;

    &lt;/LinearLayout&gt;

&lt;/RelativeLayout&gt;
</pre><p><strong>30</strong>. Open <strong>ChatRoomActivity.java</strong> modify the code as below.</p><p><strong>></strong> <strong>fetchChatThread()</strong> method fetches all the previous messages exchanged in the chat room.</p><p><strong>></strong> Broadcast receiver is registered for <strong>PUSH_NOTIFICATION</strong> in <strong>onResume()</strong> method.</p><p><strong>></strong> <strong>handlePushNotification()</strong> method handles the push message and append it to adapter array list. Upon calling the <strong>notifyDataSetChanged()</strong> the new message will be displayed in discussion thread.</p><p><strong>></strong> The self and other messages are aligned left or right by comparing the <strong>user id</strong> in the push message with the id of the user currently logged in.</p><p><strong>></strong> <strong>sendMessage()</strong> method sends a new message to server to post it in the chat room. On the server the message will sent to gcm server to broadcast it to other devices subscribed to that chat room&#8217;s topic.</p><pre class="brush: java; title: ChatRoomActivity.java; notranslate" title="ChatRoomActivity.java">
package info.androidhive.gcm.activity;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Bundle;
import android.support.v4.content.LocalBroadcastManager;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.DefaultItemAnimator;
import android.support.v7.widget.LinearLayoutManager;
import android.support.v7.widget.RecyclerView;
import android.support.v7.widget.Toolbar;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.android.volley.DefaultRetryPolicy;
import com.android.volley.NetworkResponse;
import com.android.volley.Request;
import com.android.volley.Response;
import com.android.volley.RetryPolicy;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import info.androidhive.gcm.R;
import info.androidhive.gcm.adapter.ChatRoomThreadAdapter;
import info.androidhive.gcm.app.Config;
import info.androidhive.gcm.app.EndPoints;
import info.androidhive.gcm.app.MyApplication;
import info.androidhive.gcm.gcm.NotificationUtils;
import info.androidhive.gcm.model.Message;
import info.androidhive.gcm.model.User;

public class ChatRoomActivity extends AppCompatActivity {

    private String TAG = ChatRoomActivity.class.getSimpleName();

    private String chatRoomId;
    private RecyclerView recyclerView;
    private ChatRoomThreadAdapter mAdapter;
    private ArrayList&lt;Message&gt; messageArrayList;
    private BroadcastReceiver mRegistrationBroadcastReceiver;
    private EditText inputMessage;
    private Button btnSend;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_chat_room);
        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        setSupportActionBar(toolbar);

        inputMessage = (EditText) findViewById(R.id.message);
        btnSend = (Button) findViewById(R.id.btn_send);

        Intent intent = getIntent();
        chatRoomId = intent.getStringExtra(&quot;chat_room_id&quot;);
        String title = intent.getStringExtra(&quot;name&quot;);

        getSupportActionBar().setTitle(title);
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);

        if (chatRoomId == null) {
            Toast.makeText(getApplicationContext(), &quot;Chat room not found!&quot;, Toast.LENGTH_SHORT).show();
            finish();
        }

        recyclerView = (RecyclerView) findViewById(R.id.recycler_view);

        messageArrayList = new ArrayList&lt;&gt;();

        // self user id is to identify the message owner
        String selfUserId = MyApplication.getInstance().getPrefManager().getUser().getId();

        mAdapter = new ChatRoomThreadAdapter(this, messageArrayList, selfUserId);

        LinearLayoutManager layoutManager = new LinearLayoutManager(this);
        recyclerView.setLayoutManager(layoutManager);
        recyclerView.setItemAnimator(new DefaultItemAnimator());
        recyclerView.setAdapter(mAdapter);

        mRegistrationBroadcastReceiver = new BroadcastReceiver() {
            @Override
            public void onReceive(Context context, Intent intent) {
                if (intent.getAction().equals(Config.PUSH_NOTIFICATION)) {
                    // new push message is received
                    handlePushNotification(intent);
                }
            }
        };

        btnSend.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                sendMessage();
            }
        });

        fetchChatThread();
    }

    @Override
    protected void onResume() {
        super.onResume();

        // registering the receiver for new notification
        LocalBroadcastManager.getInstance(this).registerReceiver(mRegistrationBroadcastReceiver,
                new IntentFilter(Config.PUSH_NOTIFICATION));

        NotificationUtils.clearNotifications();
    }

    @Override
    protected void onPause() {
        LocalBroadcastManager.getInstance(this).unregisterReceiver(mRegistrationBroadcastReceiver);
        super.onPause();
    }

    /**
     * Handling new push message, will add the message to
     * recycler view and scroll it to bottom
     * */
    private void handlePushNotification(Intent intent) {
        Message message = (Message) intent.getSerializableExtra(&quot;message&quot;);
        String chatRoomId = intent.getStringExtra(&quot;chat_room_id&quot;);

        if (message != null &amp;&amp; chatRoomId != null) {
            messageArrayList.add(message);
            mAdapter.notifyDataSetChanged();
            if (mAdapter.getItemCount() &gt; 1) {
                recyclerView.getLayoutManager().smoothScrollToPosition(recyclerView, null, mAdapter.getItemCount() - 1);
            }
        }
    }

    /**
     * Posting a new message in chat room
     * will make an http call to our server. Our server again sends the message
     * to all the devices as push notification
     * */
    private void sendMessage() {
        final String message = this.inputMessage.getText().toString().trim();

        if (TextUtils.isEmpty(message)) {
            Toast.makeText(getApplicationContext(), &quot;Enter a message&quot;, Toast.LENGTH_SHORT).show();
            return;
        }

        String endPoint = EndPoints.CHAT_ROOM_MESSAGE.replace(&quot;_ID_&quot;, chatRoomId);

        Log.e(TAG, &quot;endpoint: &quot; + endPoint);

        this.inputMessage.setText(&quot;&quot;);

        StringRequest strReq = new StringRequest(Request.Method.POST,
                endPoint, new Response.Listener&lt;String&gt;() {

            @Override
            public void onResponse(String response) {
                Log.e(TAG, &quot;response: &quot; + response);

                try {
                    JSONObject obj = new JSONObject(response);

                    // check for error
                    if (obj.getBoolean(&quot;error&quot;) == false) {
                        JSONObject commentObj = obj.getJSONObject(&quot;message&quot;);

                        String commentId = commentObj.getString(&quot;message_id&quot;);
                        String commentText = commentObj.getString(&quot;message&quot;);
                        String createdAt = commentObj.getString(&quot;created_at&quot;);

                        JSONObject userObj = obj.getJSONObject(&quot;user&quot;);
                        String userId = userObj.getString(&quot;user_id&quot;);
                        String userName = userObj.getString(&quot;name&quot;);
                        User user = new User(userId, userName, null);

                        Message message = new Message();
                        message.setId(commentId);
                        message.setMessage(commentText);
                        message.setCreatedAt(createdAt);
                        message.setUser(user);

                        messageArrayList.add(message);

                        mAdapter.notifyDataSetChanged();
                        if (mAdapter.getItemCount() &gt; 1) {
                            // scrolling to bottom of the recycler view
                            recyclerView.getLayoutManager().smoothScrollToPosition(recyclerView, null, mAdapter.getItemCount() - 1);
                        }

                    } else {
                        Toast.makeText(getApplicationContext(), &quot;&quot; + obj.getString(&quot;message&quot;), Toast.LENGTH_LONG).show();
                    }

                } catch (JSONException e) {
                    Log.e(TAG, &quot;json parsing error: &quot; + e.getMessage());
                    Toast.makeText(getApplicationContext(), &quot;json parse error: &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();
                }
            }
        }, new Response.ErrorListener() {

            @Override
            public void onErrorResponse(VolleyError error) {
                NetworkResponse networkResponse = error.networkResponse;
                Log.e(TAG, &quot;Volley error: &quot; + error.getMessage() + &quot;, code: &quot; + networkResponse);
                Toast.makeText(getApplicationContext(), &quot;Volley error: &quot; + error.getMessage(), Toast.LENGTH_SHORT).show();
                inputMessage.setText(message);
            }
        }) {

            @Override
            protected Map&lt;String, String&gt; getParams() {
                Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();
                params.put(&quot;user_id&quot;, MyApplication.getInstance().getPrefManager().getUser().getId());
                params.put(&quot;message&quot;, message);

                Log.e(TAG, &quot;Params: &quot; + params.toString());

                return params;
            };
        };


        // disabling retry policy so that it won't make
        // multiple http calls
        int socketTimeout = 0;
        RetryPolicy policy = new DefaultRetryPolicy(socketTimeout,
                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,
                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT);

        strReq.setRetryPolicy(policy);

        //Adding request to request queue
        MyApplication.getInstance().addToRequestQueue(strReq);
    }


    /**
     * Fetching all the messages of a single chat room
     * */
    private void fetchChatThread() {

        String endPoint = EndPoints.CHAT_THREAD.replace(&quot;_ID_&quot;, chatRoomId);
        Log.e(TAG, &quot;endPoint: &quot; + endPoint);

        StringRequest strReq = new StringRequest(Request.Method.GET,
                endPoint, new Response.Listener&lt;String&gt;() {

            @Override
            public void onResponse(String response) {
                Log.e(TAG, &quot;response: &quot; + response);

                try {
                    JSONObject obj = new JSONObject(response);

                    // check for error
                    if (obj.getBoolean(&quot;error&quot;) == false) {
                        JSONArray commentsObj = obj.getJSONArray(&quot;messages&quot;);

                        for (int i = 0; i &lt; commentsObj.length(); i++) {
                            JSONObject commentObj = (JSONObject) commentsObj.get(i);

                            String commentId = commentObj.getString(&quot;message_id&quot;);
                            String commentText = commentObj.getString(&quot;message&quot;);
                            String createdAt = commentObj.getString(&quot;created_at&quot;);

                            JSONObject userObj = commentObj.getJSONObject(&quot;user&quot;);
                            String userId = userObj.getString(&quot;user_id&quot;);
                            String userName = userObj.getString(&quot;username&quot;);
                            User user = new User(userId, userName, null);

                            Message message = new Message();
                            message.setId(commentId);
                            message.setMessage(commentText);
                            message.setCreatedAt(createdAt);
                            message.setUser(user);

                            messageArrayList.add(message);
                        }

                        mAdapter.notifyDataSetChanged();
                        if (mAdapter.getItemCount() &gt; 1) {
                            recyclerView.getLayoutManager().smoothScrollToPosition(recyclerView, null, mAdapter.getItemCount() - 1);
                        }

                    } else {
                        Toast.makeText(getApplicationContext(), &quot;&quot; + obj.getJSONObject(&quot;error&quot;).getString(&quot;message&quot;), Toast.LENGTH_LONG).show();
                    }

                } catch (JSONException e) {
                    Log.e(TAG, &quot;json parsing error: &quot; + e.getMessage());
                    Toast.makeText(getApplicationContext(), &quot;json parse error: &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();
                }
            }
        }, new Response.ErrorListener() {

            @Override
            public void onErrorResponse(VolleyError error) {
                NetworkResponse networkResponse = error.networkResponse;
                Log.e(TAG, &quot;Volley error: &quot; + error.getMessage() + &quot;, code: &quot; + networkResponse);
                Toast.makeText(getApplicationContext(), &quot;Volley error: &quot; + error.getMessage(), Toast.LENGTH_SHORT).show();
            }
        });

        //Adding request to request queue
        MyApplication.getInstance().addToRequestQueue(strReq);
    }

}
</pre><p>Now deploy the app on two different devices and try sending the messages in a chat room. The other device should start receiving the messages. You can also use the admin panel <a rel="nofollow" href="http://localhost/gcm_chat" target="_blank">http://localhost/gcm_chat</a> to send the messages to both the devices. You can also minimize the app and check the new messages in notification bar.</p><div class="image"> <img src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-discussion-screen-self-other-messages.png" alt="android-realtime-chat-app-discussion-screen-self-other-messages" width="720" height="773" class="alignnone size-full wp-image-39049" srcset="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-discussion-screen-self-other-messages-279x300.png 279w, http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-discussion-screen-self-other-messages.png 720w" sizes="(max-width: 720px) 100vw, 720px" /><noscript><img src="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-discussion-screen-self-other-messages.png" alt="android-realtime-chat-app-discussion-screen-self-other-messages" width="720" height="773" class="alignnone size-full wp-image-39049" srcset="http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-discussion-screen-self-other-messages-279x300.png 279w, http://www.androidhive.info/wp-content/uploads/2016/02/android-realtime-chat-app-discussion-screen-self-other-messages.png 720w" sizes="(max-width: 720px) 100vw, 720px" /></noscript></div><h2>Live Demo</h2><p>Here is the <a href="http://demo.androidhive.info/gcm_chat/" target="_blank">Live Demo</a> of the app where you can download the <a href="http://demo.androidhive.info/gcm_chat/gcm_realtime_chat.apk" target="_blank">apk</a> and test it from the admin panel. Note that this apk is signed with my GCM API Key. So the live demo works only with the apk I have provided.</p><div style="font-size:0px;height:0px;line-height:0px;margin:0;padding:0;clear:both"></div><span id="tve_leads_end_content" style="display: block; visibility: hidden; border: 1px solid red;"></span> <script type="text/javascript">jQuery(document).ready(function($) {
    $.post('http://www.androidhive.info/wp-admin/admin-ajax.php', {action: 'mts_view_count', id: '39056'});
});</script> </div></div></div><div class="postauthor"><h4>About The Author</h4> <img alt='' src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src='http://0.gravatar.com/avatar/9578184c8f454a148b0b59dd1d21dfaf?s=100&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9578184c8f454a148b0b59dd1d21dfaf?s=200&amp;d=mm&amp;r=g 2x' class='avatar avatar-100 photo' height='100' width='100' /><noscript><img alt='' src='http://0.gravatar.com/avatar/9578184c8f454a148b0b59dd1d21dfaf?s=100&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9578184c8f454a148b0b59dd1d21dfaf?s=200&amp;d=mm&amp;r=g 2x' class='avatar avatar-100 photo' height='100' width='100' /></noscript><h5 class="vcard"><a href="http://www.androidhive.info/author/admin/" rel="nofollow" class="fn">Ravi Tamada</a></h5><p>Ravi is hardcore Android programmer and Android programming has been his passion since he compiled his first hello-world program. Solving real problems of Android developers through tutorials has always been interesting part for him.</p></div><div class="related-posts"><h4>Related Posts</h4><div class="clear"> <article class="latestPost excerpt  "> <a href="http://www.androidhive.info/2014/02/android-login-with-google-plus-account-1/" title="Android Login with Google Plus Account" rel="nofollow" id="featured-thumbnail"><div class="featured-thumbnail"><img width="270" height="165" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://www.androidhive.info/wp-content/uploads/2014/02/android-google-plus-banner-270x165.png" class="attachment-featured size-featured wp-post-image" alt="android login with google plus account" title="" /><noscript><img width="270" height="165" src="http://www.androidhive.info/wp-content/uploads/2014/02/android-google-plus-banner-270x165.png" class="attachment-featured size-featured wp-post-image" alt="android login with google plus account" title="" /></noscript></div> </a> <header><h2 class="title front-view-title"><a href="http://www.androidhive.info/2014/02/android-login-with-google-plus-account-1/" title="Android Login with Google Plus Account">Android Login with Google Plus Account</a></h2><div class="post-info"> <span class="theauthor">by <span itemprop="author"><a rel="nofollow" href="http://www.androidhive.info/author/admin/" title="Posts by Ravi Tamada" rel="author">Ravi Tamada</a><span class="divider1">/</span></div> </header> </article> <article class="latestPost excerpt  "> <a href="http://www.androidhive.info/2014/06/android-facebook-like-custom-listview-feed-using-volley/" title="Android Facebook like Custom ListView Feed using Volley" rel="nofollow" id="featured-thumbnail"><div class="featured-thumbnail"><img width="270" height="165" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://www.androidhive.info/wp-content/uploads/2014/06/android-facebook-like-news-feed-270x165.jpg" class="attachment-featured size-featured wp-post-image" alt="android facebook like custom news feed view" title="" /><noscript><img width="270" height="165" src="http://www.androidhive.info/wp-content/uploads/2014/06/android-facebook-like-news-feed-270x165.jpg" class="attachment-featured size-featured wp-post-image" alt="android facebook like custom news feed view" title="" /></noscript></div> </a> <header><h2 class="title front-view-title"><a href="http://www.androidhive.info/2014/06/android-facebook-like-custom-listview-feed-using-volley/" title="Android Facebook like Custom ListView Feed using Volley">Android Facebook like Custom ListView Feed using Volley</a></h2><div class="post-info"> <span class="theauthor">by <span itemprop="author"><a rel="nofollow" href="http://www.androidhive.info/author/admin/" title="Posts by Ravi Tamada" rel="author">Ravi Tamada</a><span class="divider1">/</span></div> </header> </article> <article class="latestPost excerpt  last"> <a href="http://www.androidhive.info/2014/12/android-uploading-camera-image-video-to-server-with-progress-bar/" title="Android Uploading Camera Image, Video to Server with Progress Bar" rel="nofollow" id="featured-thumbnail"><div class="featured-thumbnail"><img width="270" height="165" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://www.androidhive.info/wp-content/uploads/2014/12/android-file-upload-with-progress-bar-270x165.jpg" class="attachment-featured size-featured wp-post-image" alt="android file upload with progress bar" title="" /><noscript><img width="270" height="165" src="http://www.androidhive.info/wp-content/uploads/2014/12/android-file-upload-with-progress-bar-270x165.jpg" class="attachment-featured size-featured wp-post-image" alt="android file upload with progress bar" title="" /></noscript></div> </a> <header><h2 class="title front-view-title"><a href="http://www.androidhive.info/2014/12/android-uploading-camera-image-video-to-server-with-progress-bar/" title="Android Uploading Camera Image, Video to Server with Progress Bar">Android Uploading Camera Image, Video to Server with Progress Bar</a></h2><div class="post-info"> <span class="theauthor">by <span itemprop="author"><a rel="nofollow" href="http://www.androidhive.info/author/admin/" title="Posts by Ravi Tamada" rel="author">Ravi Tamada</a><span class="divider1">/</span></div> </header> </article> <article class="latestPost excerpt  "> <a href="http://www.androidhive.info/2014/05/android-working-with-volley-library-1/" title="Android working with Volley Library" rel="nofollow" id="featured-thumbnail"><div class="featured-thumbnail"><img width="270" height="165" src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://www.androidhive.info/wp-content/uploads/2014/04/android-volley-library-270x165.jpg" class="attachment-featured size-featured wp-post-image" alt="android volley library tutorial" title="" /><noscript><img width="270" height="165" src="http://www.androidhive.info/wp-content/uploads/2014/04/android-volley-library-270x165.jpg" class="attachment-featured size-featured wp-post-image" alt="android volley library tutorial" title="" /></noscript></div> </a> <header><h2 class="title front-view-title"><a href="http://www.androidhive.info/2014/05/android-working-with-volley-library-1/" title="Android working with Volley Library">Android working with Volley Library</a></h2><div class="post-info"> <span class="theauthor">by <span itemprop="author"><a rel="nofollow" href="http://www.androidhive.info/author/admin/" title="Posts by Ravi Tamada" rel="author">Ravi Tamada</a><span class="divider1">/</span></div> </header> </article></div></div></div><div id="disqus_thread" data-disqus-shortname="androidhive"></div></div> </article> <aside id="sidebar" class="sidebar c-4-12 " role="complementary" itemscope itemtype="http://schema.org/WPSideBar"><div id="search-2" class="widget widget_search"><h3 class="widget-title">SEARCH HERE</h3><form method="get" id="searchform" class="search-form" action="http://www.androidhive.info" _lpchecked="1"><fieldset> <input type="text" name="s" id="s" value="" placeholder="Search the site"  /> <button id="search-image" class="sbutton" type="submit" value=""> <i class="fa fa-search"></i> </button></fieldset></form></div><div id="text-9" class="widget widget_text"><div class="textwidget"><a href="http://www.androidhive.info/reviews"><img src="data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=" data-lazy-src="http://api.androidhive.info/tmp/reviews_banner.jpg"/><noscript><img src="http://api.androidhive.info/tmp/reviews_banner.jpg"/></noscript></a></div></div><div id="text-6" class="widget widget_text"><h3 class="widget-title">WERE SOCIAL</h3><div class="textwidget"><div class="fb-page"
data-href="https://www.facebook.com/AndroidHive/"
data-width="340"
data-hide-cover="false"
data-show-facepile="true"></div></div></div><div id="text-8" class="widget widget_text"><div class="textwidget"><div class="tve-leads-shortcode tve-tl-anim tl-anim-instant tve-leads-track-shortcode_39260"><div class="tl-style" id="tve_36_set" data-state="6"><div class="tve-leads-conversion-object" data-tl-type="shortcode_39260"><div class="tve_flt"><div class="thrv-leads-form-box tve_no_drag tve_no_icons tve_element_hover thrv_wrapper tve_editor_main_content tve_36_set tve_brdr_solid tve_blue"><h2 class="tve_p_center" style="font-size: 17px;">Subscribe to Newsletter</h2><p class="tve_p_center" style="font-size: 14px;">Join our 746,498 subscribers and get access to the latest android tutorials, freebies, scripts and much more!</p><div class="thrv_wrapper thrv_lead_generation tve_clearfix tve_red tve_11 thrv_lead_generation_vertical" data-tve-style="1" data-tve-version="1" data-inputs-count="11" data-connection="api"><input type="hidden" class="tve-lg-err-msg" value="{&quot;email&quot;:&quot;Please enter a valid email address&quot;,&quot;phone&quot;:&quot;Please enter a valid phone number&quot;,&quot;required&quot;:&quot;Highlighted fields are required&quot;}"><div class="thrv_lead_generation_code" style="display: none;"></div><div class="thrv_lead_generation_container tve_clearfix"><form action="#" method="post"><input type="hidden" class="tve-f-a-hidden" value="#"><div class="tve_lead_generated_inputs_container tve_clearfix"><div class="tve_lead_fields_overlay"></div><div class="tve_lg_input_container tve_lg_input tve_lg_2"><input type="email" data-field="email" data-required="1" data-validation="email" name="email" placeholder="Email" data-placeholder="Email" style="padding-right: 20px;"></div><input id="__tcb_lg_fc" type="hidden" name="__tcb_lg_fc" value="YToxOntzOjU6InNlbmR5IjtzOjI0OiJTcHMzNzYzaEwweTVrbnZHS2xIVjB4QnciO30="><input id="_asset_group" type="hidden" name="_asset_group" value=""><input id="_asset_option" type="hidden" name="_asset_option" value=""><input id="_back_url" type="hidden" name="_back_url" value="http://www.androidhive.info/subscription-successful/"><input id="_submit_option" type="hidden" name="_submit_option" value="redirect"><input id="_use_captcha" type="hidden" name="_use_captcha" value=""><input id="_captcha_theme" type="hidden" name="_captcha_theme" value="light"><input id="_captcha_type" type="hidden" name="_captcha_type" value="image"><input id="_captcha_size" type="hidden" name="_captcha_size" value="normal"><div style="display: none"></div><div class="tve_lg_input_container tve_submit_container tve_lg_submit tve_lg_2" tve-data-style="1"><button type="Submit">Sign Up</button></div></div></form></div></div><p class="tve_p_center" style="font-size: 14px;">We strictly care about your privacy!</p></div></div></div></div></div></div></div><div id="views-2" class="widget widget_views"><h3 class="widget-title">POPULAR ANDROID TUTORIALS</h3><ul><li class="postviews"><a href="http://www.androidhive.info/2011/11/android-sqlite-database-tutorial/"  title="Android SQLite Database Tutorial">Android SQLite Database Tutorial - 1,451,467 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2012/05/how-to-connect-android-with-php-mysql/"  title="How to connect Android with PHP, MySQL">How to connect Android with PHP, MySQL - 1,434,222 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2012/01/android-json-parsing-tutorial/"  title="Android JSON Parsing Tutorial">Android JSON Parsing Tutorial - 1,283,625 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2012/10/android-push-notifications-using-google-cloud-messaging-gcm-php-and-mysql/"  title="Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL">Android Push Notifications using Google Cloud Messaging (GCM), PHP and MySQL - 1,215,920 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2013/11/android-sliding-menu-using-navigation-drawer/"  title="Android Sliding Menu using Navigation Drawer">Android Sliding Menu using Navigation Drawer - 1,121,008 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2012/02/android-custom-listview-with-image-and-text/"  title="Android Custom ListView with Image and Text">Android Custom ListView with Image and Text - 988,386 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2012/01/android-login-and-registration-with-php-mysql-and-sqlite/"  title="Android Login and Registration with PHP, MySQL and SQLite">Android Login and Registration with PHP, MySQL and SQLite - 986,914 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2012/07/android-gps-location-manager-tutorial/"  title="Android GPS, Location Manager Tutorial">Android GPS, Location Manager Tutorial - 754,124 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2013/10/android-tab-layout-with-swipeable-views-1/"  title="Android Tab Layout with Swipeable Views">Android Tab Layout with Swipeable Views - 702,932 views</a></li><li class="postviews"><a href="http://www.androidhive.info/2013/08/android-working-with-google-maps-v2/"  title="Android working with Google Maps V2">Android working with Google Maps V2 - 623,736 views</a></li></ul></div></aside></div> <footer id="site-footer" role="contentinfo" itemscope itemtype="http://schema.org/WPFooter"><div class="container"><div class="footer-widgets first-footer-widgets widgets-num-3"><div class="f-widget f-widget-1"><div id="nav_menu-2" class="widget widget_nav_menu"><h3 class="widget-title">QUICK CONTACT</h3><div class="menu-quick-contact-container"><ul id="menu-quick-contact" class="menu"><li id="menu-item-39273" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39273"><a href="http://www.androidhive.info/advertise-with-us/">Advertise with us</a></li><li id="menu-item-39244" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39244"><a href="http://www.androidhive.info/privacy-policy/">Privacy Policy</a></li><li id="menu-item-39245" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39245"><a href="http://www.androidhive.info/terms-of-service/">Terms of Service</a></li><li id="menu-item-39266" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-39266"><a href="http://www.androidhive.info/sitemap/">Sitemap</a></li></ul></div></div></div><div class="f-widget f-widget-2"></div><div class="f-widget last f-widget-3"><div id="text-7" class="widget widget_text"><h3 class="widget-title">ABOUT ANDROIDHIVE</h3><div class="textwidget">AndroidHive is beginner's paradise for android tutorials, tips & tricks, games, app reviews, hacks and super cool advanced topics.</div></div></div></div><div class="copyrights"><div class="row" id="copyright-note"> <span>Copyright &copy; 2016 Droid5 Informatics Pvt Ltd.</span><div class="to-top"></div></div></div></div> </footer></div><div id="fb-root"></div> <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&version=v2.6";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script> <script id="dsq-count-scr" src="//androidhive.disqus.com/count.js" async></script> <script>/**************************************************************/
/*AM22 Named Function to load Disqus - START*/
jQuery(document).ready(function(){
var disqus_identifier = window.location.url; //Use current page URL as Disqus_URL_Identifier. You can change it as per your requirement.
var ds_loaded = false; //To track loading only once on a page.
function loadDisqus()
{
    var disqus_div = jQuery("#disqus_thread"); //The ID of the Disqus DIV tag
    var top = disqus_div.offset().top;
    var disqus_data = disqus_div.data();
    if ( !ds_loaded && jQuery(window).scrollTop() + jQuery(window).height() > top ) 
    {
        ds_loaded = true;
        for (var key in disqus_data) 
        {
            if (key.substr(0,6) == 'disqus') 
            {
                window['disqus_' + key.replace('disqus','').toLowerCase()] = disqus_data[key];
            }
        }
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = 'http://' + window.disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }  
}
/*AM22 Named Function to load Disqus - END*/
/*AM22 Disqus lazy load - START*/
jQuery(function () 
{
    var disqus_div = jQuery("#disqus_thread");
    if (disqus_div.size() > 0) 
    {
        jQuery(window).scroll(loadDisqus);      
    }  
}
);
/*AM22 Disqus lazy load - END*/
});</script><div id="tve_notification_box"></div><script type='text/javascript' src='http://www.androidhive.info/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.9b'></script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPhp.js?ver=3.0.9b'></script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJava.js?ver=3.0.9b'></script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.9b'></script> <script type='text/javascript'>(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://www.androidhive.info/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://www.androidhive.info/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();</script> <link rel='stylesheet' id='tve-leads-font-9062833c9baa57b288ba47a7993dc1c0-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A400%2C300%2C600%2C700' type='text/css' media='all' /> <script type='text/javascript'>/*  */
var viewsCacheL10n = {"admin_ajax_url":"http:\/\/www.androidhive.info\/wp-admin\/admin-ajax.php","post_id":"39056"};
/*  */</script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/plugins/wp-postviews/postviews-cache.js?ver=1.68'></script> <script type='text/javascript'>/*  */
var tve_dash_front = {"ajaxurl":"http:\/\/www.androidhive.info\/wp-admin\/admin-ajax.php"};
/*  */</script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/plugins/thrive-leads/thrive-dashboard/js/dist/frontend.min.js?ver=1.0.10'></script> <script type='text/javascript' src='http://www.androidhive.info/wp-includes/js/wp-embed.min.js'></script> <script type='text/javascript'>/*  */
var tve_frontend_options = {"is_editor_page":"","page_events":[],"is_single":"1","ajaxurl":"http:\/\/www.androidhive.info\/wp-admin\/admin-ajax.php","social_fb_app_id":""};
/*  */</script> <script type='text/javascript' src='http://www.androidhive.info/wp-content/plugins/thrive-leads/tcb/editor/js/thrive_content_builder_frontend.min.js?ver=1.200.5'></script> <script type='text/javascript' src='//www.androidhive.info/wp-content/plugins/thrive-leads/js/frontend.min.js?ver=1.75'></script> <script type="text/javascript">/**/var TL_Const={"security":"62e7a1ef75","ajax_url":"\/\/www.androidhive.info\/wp-admin\/admin-ajax.php","forms":{"shortcode_39260":{"_key":"6","trigger":"page_load","trigger_config":{},"form_type_id":"39260","main_group_id":"39260","active_test_id":""}},"action_conversion":"tve_leads_ajax_conversion","action_impression":"tve_leads_ajax_impression","ajax_load":0,"shortcode_ids":["39260"],"custom_post_data":{"get_data":{"q":"\/2016\/02\/android-push-notifications-using-gcm-php-mysql-realtime-chat-app-part-3\/"},"http_referrer":"http:\/\/www.google.co.uk\/url?sa=t&source=web&cd=1"},"current_screen":{"screen_type":4,"screen_id":39056},"ignored_fields":["email","_captcha_size","_captcha_theme","_captcha_type","_submit_option","_use_captcha","g-recaptcha-response","__tcb_lg_fc","_back_url","_submit_option","url","_asset_group","_asset_option","mailchimp_optin"]}/* */</script><script type="text/javascript">var TL_Front = TL_Front || {}; TL_Front.impressions_data = TL_Front.impressions_data || {};TL_Front.impressions_data.shortcode_39260 = {"group_id":"39260","form_type_id":"39260","variation_key":"6","active_test_id":null,"output_js":true};</script><script type="text/javascript">(function ($) {
	$(function () {
		var event_data = {"form_id":"tve-leads-track-shortcode_39260","form_type":"shortcode"};
		event_data.source = 'page_load';
		setTimeout(function () {
			ThriveGlobal.$j(TL_Front).trigger('showform.thriveleads', event_data);
			}, 200);
		});
	})
(ThriveGlobal.$j);</script></body></html>
<!-- This website is like a Rocket, isn't it ? Performance optimized by WP Rocket. Learn more: http://wp-rocket.me - Debug: cached@1470854882 -->